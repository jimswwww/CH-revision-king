<!DOCTYPE html>
<html lang="zh-Hant"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ­·å²éš¨èº«æ¸¬ (æœ€æ–°ç‰ˆ)</title>
    <style>
        :root {
            --primary: #1a237e;      /* ä¸»è‰²ï¼šæ·±è— */
            --primary-light: #534bae;
            --white: #ffffff;
            --bg: #f5f5f5;
            --text: #333333;
            --success: #4caf50;      /* ç¶ è‰² */
            --error: #f44336;        /* ç´…è‰² */
            --warning: #ff9800;      /* æ©˜è‰² */
            --info: #2196f3;         /* è—è‰² (ç·¨è¼¯ç”¨) */
            --gray: #9e9e9e;
            --border-radius: 12px;
            --header-height: 60px;
        }

        * {
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            background-color: var(--bg);
            color: var(--text);
            padding-top: var(--header-height);
            overflow-x: hidden;
        }

        /* --- Header --- */
        header {
            position: fixed;
            top: 0; left: 0; right: 0;
            height: var(--header-height);
            background-color: var(--primary);
            color: var(--white);
            display: flex;
            align-items: center;
            padding: 0 16px;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .menu-toggle {
            font-size: 24px;
            cursor: pointer;
            margin-right: 16px;
            background: none;
            border: none;
            color: white;
            padding: 8px;
        }

        .app-title {
            font-size: 20px;
            font-weight: bold;
        }

        /* --- Sidebar Navigation --- */
        .sidebar-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1001;
            display: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .sidebar {
            position: fixed;
            top: 0; left: -280px;
            width: 280px;
            height: 100%;
            background: var(--white);
            z-index: 1002;
            transition: left 0.3s ease;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .sidebar.open { left: 0; }

        .sidebar-header {
            background-color: var(--primary);
            color: var(--white);
            padding: 20px;
            font-size: 18px;
            font-weight: bold;
        }

        .nav-part-header {
            padding: 15px 20px;
            background: #FFF8D7;
            color: #333;
            font-size: 18px;
            font-weight: bold;
        }

        .nav-submenu {
            display: none;
            background-color: #f9f9f9;
        }

        /* ä¸€èˆ¬å–®å…ƒé …ç›® */
        .nav-item {
            padding: 12px 20px 12px 30px;
            color: #555;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            font-size: 15px;
        }

        .nav-group-title {
            padding: 15px 20px;
            font-weight: 600;
            color: var(--text);
            border-bottom: 1px solid #eee;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* --- å­é¸å–®æ¨£å¼ (è³‡æ–™å¤¾) --- */
        .unit-group-title {
            padding: 2px 10px 2px 20px;
            color: #666;
            font-weight: 600;
            border-bottom: 1px solid #eee;
            background-color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .unit-click-area {
            flex: 1;
            cursor: pointer;
            padding: 8px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .unit-group-title:hover {
            background-color: #f5f5f5;
        }

        .unit-submenu {
            display: none;
            background-color: #f0f0f0;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }

        .unit-sub-item {
            padding: 10px 20px 10px 50px; /* ç¸®æ’ */
            color: #333;
            border-bottom: 1px solid #e0e0e0;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.2s;
            font-weight: bold;

        }

        .unit-sub-item:hover {
            background-color: #e3f2fd;
            color: var(--primary);
        }

        .arrow {
 	   transition: transform 0.3s; /* æ—‹è½‰å‹•ç•«æ•ˆæœ (ä¿ç•™) */
    
  	   /* 1. èª¿æ•´å¤§å° */
 	   font-size: 18px;  /* æ•¸å­—è¶Šå¤§ï¼Œç®­é ­è¶Šå¤§ (åŸæœ¬æ˜¯ 12px) */
    
 	   /* 2. èª¿æ•´å·¦å³ä½ç½® */
 	   margin-left: 15px;  /* é›¢å·¦é‚Šçš„æ–‡å­—é ä¸€é» */
   	   margin-right: 5px;  /* é›¢å³é‚Šé‚Šç•Œé ä¸€é» (è‹¥è¦ºå¾—å¤ªé é‚Šå¯åŠ é€™è¡Œ) */
	
   	   /* 3. èª¿æ•´ä¸Šä¸‹å¾®èª¿ (å¦‚æœè¦ºå¾—ç®­é ­æ²’æœ‰å‚ç›´ç½®ä¸­) */
   	   position: relative; 
  	   top: -2px;          /* è² æ•¸å¾€ä¸Šç§»ï¼Œæ­£æ•¸å¾€ä¸‹ç§» */
 	 	  
    /* æˆ–è€…æ”¹è®Šé¡è‰² */
    color: #999;        /* æ·ºç°è‰²ï¼Œè‹¥ä¸å¯«å‰‡è·Ÿéš¨æ–‡å­—é¡è‰² */
	}
        .rotate { transform: rotate(180deg); }


        /* --- Main Content Views --- */
        .view-section {
            display: none;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            animation: fadeIn 0.3s;
        }

        .view-section.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Card Styles --- */
        .card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        /* --- Quiz Interface --- */
        .quiz-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            color: var(--gray);
            font-size: 14px;
        }

        .question-text {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .option-btn {
            width: 100%;
            padding: 16px;
            margin-bottom: 16px;
            background: var(--white);
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 18px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .option-btn:active { transform: scale(0.98); }

        .option-btn.correct {
            background-color: #e8f5e9;
            border-color: var(--success);
            color: #2e7d32;
        }

        .option-btn.wrong {
            background-color: #ffebee;
            border-color: var(--error);
            color: #c62828;
        }

        .option-btn.disabled {
            pointer-events: none;
            opacity: 0.8;
        }

        .explanation {
            margin-top: 20px;
            padding: 16px;
            background-color: #e3f2fd;
            border-left: 5px solid #2196f3;
            border-radius: 4px;
            display: none;
            line-height: 1.6;
        }

        .next-btn {
            width: 100%;
            padding: 16px;
            background-color: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            margin-top: 20px;
            cursor: pointer;
            display: none;
            box-shadow: 0 4px 10px rgba(26, 35, 126, 0.3);
        }

        /* --- Answer Key View --- */
        .ans-item {
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }
        
        /* --- History View --- */
        .history-card {
            border-left: 5px solid #ddd;
            position: relative;
        }
        .history-card.done { border-left-color: var(--success); }
        .history-card.has-wrong { border-left-color: var(--error); }
        
        .history-meta { font-size: 13px; color: var(--gray); margin-top: 5px; }
        .score-badge {
            float: right;
            font-weight: bold;
            font-size: 18px;
            color: var(--primary);
        }
        
        /* --- Modal --- */
        .modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }
        .modal-content {
            background: var(--white);
            width: 100%;
            max-width: 450px;
            padding: 24px;
            border-radius: 16px;
            text-align: center;
            max-height: 90vh;
            overflow-y: auto;
        }
        .mode-btn {
            display: block;
            width: 100%;
            padding: 14px;
            margin: 12px 0;
            border: 2px solid var(--primary);
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            background: white;
            color: var(--primary);
        }
        .mode-btn.primary { background: var(--primary); color: white; }

        /* --- å‡ºé¡Œèˆ‡åˆªé¡Œç³»çµ±æ¨£å¼ --- */
        .generator-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .input-area {
            width: 100%;
            height: 300px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            font-family: monospace;
        }

        .input-area:focus {
            outline: none;
            border-color: var(--primary);
        }

        .help-text {
            font-size: 13px;
            color: #666;
            background: #f0f0f0;
            padding: 10px;
            border-radius: 8px;
        }

        .action-bar {
            display: flex;
            gap: 10px;
        }
        
        /* çµæ§‹ç®¡ç†åˆ—è¡¨æ¨£å¼ */
        .manage-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #eee;
            background: #fff;
            gap: 10px;
        }
        .manage-item:last-child { border-bottom: none; }
        
        .manage-info { flex: 1; font-size: 15px; color: #333; }
        
        .manage-actions { display: flex; gap: 5px; }
        
        .sm-btn {
            padding: 5px 10px; font-size: 14px; border-radius: 6px; cursor: pointer; border: 1px solid #ddd; background: #fff;
        }
        .sm-btn:hover { background: #f0f0f0; }
        .sm-btn.del { color: var(--error); border-color: var(--error); }
        .sm-btn.del:hover { background: #ffebee; }
        
        /* åˆªé¡Œèˆ‡ç·¨è¼¯åˆ—è¡¨ */
        .delete-item {
            display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; background: #fff; gap: 8px;
        }
        .delete-item:last-child { border-bottom: none; }
        
        .delete-btn { background-color: #ffebee; color: var(--error); border: 1px solid var(--error); border-radius: 4px; padding: 5px 10px; cursor: pointer; font-size: 12px; min-width: 60px; }
        .delete-btn:hover { background-color: var(--error); color: white; }
        
        /* æ–°å¢ï¼šç·¨è¼¯æŒ‰éˆ•æ¨£å¼ */
        .edit-btn { background-color: #e3f2fd; color: var(--info); border: 1px solid var(--info); border-radius: 4px; padding: 5px 10px; cursor: pointer; font-size: 12px; min-width: 40px; }
        .edit-btn:hover { background-color: var(--info); color: white; }

        /* æ··åˆæ¸¬é©—é¸å–®æ¨£å¼ */
        .mixed-quiz-btn {
            font-size: 12px;
            background: #e3f2fd;
            color: var(--primary);
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid var(--primary);
            margin-right: 10px;
            cursor: pointer;
        }
        .mixed-quiz-btn:hover { background: var(--primary); color: white; }
        
        .checkbox-list {
            text-align: left;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .checkbox-item input { margin-right: 10px; transform: scale(1.2); }
        
        /* ç·¨è¼¯é¡Œç›®è¡¨å–® */
        .edit-form-row { margin-bottom: 10px; text-align: left; }
        .edit-form-label { font-size: 12px; color: #666; font-weight: bold; margin-bottom: 4px; display: block; }
        .edit-form-input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        .edit-form-textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; height: 60px; resize: vertical; }
    </style>
</head>
<body>

<header>
    <button class="menu-toggle" onclick="toggleSidebar()">â˜°</button>
    <div class="app-title">æ­·å²éš¨èº«æ¸¬</div>
    
    <button onclick="location.reload()" style="background:none; border:none; color:white; font-size:14px; margin-left:10px; cursor:pointer; padding:0;">[è¿”å›ä¸»é ]</button>
    <div id="nav-clock" style="margin-left: auto; font-size: 0.9em; font-family: monospace; white-space: nowrap;">
        Loading...
    </div>
</header>

<div class="sidebar-overlay" onclick="toggleSidebar()" style="display: none; opacity: 0;"></div>
<div class="sidebar" id="sidebar">
    <div class="sidebar-header">åŠŸèƒ½é¸å–®</div>
    
    <div class="nav-group-title" onclick="toggleSubmenu('menu-quiz', this)">
    <span>ğŸ“ é–‹å§‹æ¸¬é©—</span> <span class="arrow">â–¼</span> </div>
    <div id="menu-quiz" class="nav-submenu" style="display: none;"><div class="nav-part-header">ç”²éƒ¨</div>
                        <div class="unit-group-title">
                            <div class="unit-click-area" onclick="toggleUnitSubmenu(this)">
                                <span>å¤å•†å‘¨</span>
                                <span class="arrow">â–¼</span>
                            </div>
                            <button class="mixed-quiz-btn" onclick="openMixedModeModal('u_1768479449174_nr89z', 'å¤å•†å‘¨')">ğŸš€ ç¶œåˆ</button>
                        </div>
                        <div class="unit-submenu">
                            <div class="unit-sub-item" onclick="openModeModal('u_1768479449174_lx1pi', 'å…©æ¬¡åˆ†å°')">å…©æ¬¡åˆ†å°</div><div class="unit-sub-item" onclick="openModeModal('u_1768479449174_q64k1', 'å°å»ºã€ç¦®æ¨‚ã€å®—æ³•åˆ¶åº¦')">å°å»ºã€ç¦®æ¨‚ã€å®—æ³•åˆ¶åº¦</div><div class="unit-sub-item" onclick="openModeModal('u_1768479449174_riz5p', 'æ˜¥ç§‹æˆ°åœ‹çš„æ”¿æ²»è®Šå‹•')">æ˜¥ç§‹æˆ°åœ‹çš„æ”¿æ²»è®Šå‹•</div><div class="unit-sub-item" onclick="openModeModal('u_1768479449174_ght5l', 'æ˜¥ç§‹æˆ°åœ‹çš„ç¤¾æœƒè®Šå‹•')">æ˜¥ç§‹æˆ°åœ‹çš„ç¤¾æœƒè®Šå‹•</div>
                        </div>
                        <div class="unit-group-title">
                            <div class="unit-click-area" onclick="toggleUnitSubmenu(this)">
                                <span>ç§¦æ¼¢</span>
                                <span class="arrow">â–¼</span>
                            </div>
                            <button class="mixed-quiz-btn" onclick="openMixedModeModal('u_1768479449174_jvdpc', 'ç§¦æ¼¢')">ğŸš€ ç¶œåˆ</button>
                        </div>
                        <div class="unit-submenu">
                            <div class="unit-sub-item" onclick="openModeModal('u_1768479449174_mdm59', 'ç§¦å§‹çš‡çš„çµ±æ²»æ€æƒ³')">ç§¦å§‹çš‡çš„çµ±æ²»æ€æƒ³</div><div class="unit-sub-item" onclick="openModeModal('u_1768479449174_mvexj', 'ç§¦å§‹çš‡çš„çµ±æ²»æ”¿ç­–')">ç§¦å§‹çš‡çš„çµ±æ²»æ”¿ç­–</div><div class="unit-sub-item" onclick="openModeModal('u_1768479449174_mzdgb', 'æ¼¢æ­¦å¸çš„çµ±æ²»æ€æƒ³')">æ¼¢æ­¦å¸çš„çµ±æ²»æ€æƒ³</div><div class="unit-sub-item" onclick="openModeModal('u_1768479449174_v115d', 'æ¼¢æ­¦å¸çš„çµ±æ²»æ”¿ç­–')">æ¼¢æ­¦å¸çš„çµ±æ²»æ”¿ç­–</div>
                        </div>
                        <div class="unit-group-title">
                            <div class="unit-click-area" onclick="toggleUnitSubmenu(this)">
                                <span>éš‹å”</span>
                                <span class="arrow">â–¼</span>
                            </div>
                            <button class="mixed-quiz-btn" onclick="openMixedModeModal('u_1768479449174_la24y', 'éš‹å”')">ğŸš€ ç¶œåˆ</button>
                        </div>
                        <div class="unit-submenu">
                            <div class="unit-sub-item" onclick="openModeModal('u_1768479449174_r9vo5', 'é–‹çš‡ä¹‹æ²»')">é–‹çš‡ä¹‹æ²»</div><div class="unit-sub-item" onclick="openModeModal('u_1768479449174_pd40w', 'è²è§€ä¹‹æ²»')">è²è§€ä¹‹æ²»</div><div class="unit-sub-item" onclick="openModeModal('u_1768479449174_3f9yh', 'é–‹å…ƒä¹‹æ²»')">é–‹å…ƒä¹‹æ²»</div><div class="unit-sub-item" onclick="openModeModal('u_1768479449174_hujez', 'å®‰å²ä¹‹äº‚')">å®‰å²ä¹‹äº‚</div>
                        </div>
                        <div class="unit-group-title">
                            <div class="unit-click-area" onclick="toggleUnitSubmenu(this)">
                                <span>å®‹å…ƒæ˜æ¸…</span>
                                <span class="arrow">â–¼</span>
                            </div>
                            <button class="mixed-quiz-btn" onclick="openMixedModeModal('u_1768479449174_l18d2', 'å®‹å…ƒæ˜æ¸…')">ğŸš€ ç¶œåˆ</button>
                        </div>
                        <div class="unit-submenu">
                            <div class="unit-sub-item" onclick="openModeModal('u_1768479449174_prib8', 'æ˜å¤ªç¥–çš„å›ä¸»é›†æ¬Š')">æ˜å¤ªç¥–çš„å›ä¸»é›†æ¬Š</div><div class="unit-sub-item" onclick="openModeModal('u_1768479449174_zgj24', 'æ˜æˆç¥–çš„å›ä¸»é›†æ¬Š')">æ˜æˆç¥–çš„å›ä¸»é›†æ¬Š</div><div class="unit-sub-item" onclick="openModeModal('u_1768479449174_p5r8r', 'æ˜ä»£å›ä¸»é›†æ¬Šçš„æˆæ•ˆèˆ‡æµå¼Š')">æ˜ä»£å›ä¸»é›†æ¬Šçš„æˆæ•ˆèˆ‡æµå¼Š</div>
                        </div><div class="nav-part-header">ä¹™éƒ¨</div>
                        <div class="unit-group-title">
                            <div class="unit-click-area" onclick="toggleUnitSubmenu(this)">
                                <span>ä¸­è¯äººæ°‘å…±å’Œåœ‹</span>
                                <span class="arrow rotate">â–¼</span>
                            </div>
                            <button class="mixed-quiz-btn" onclick="openMixedModeModal('u_1768480267921_1ryh3', 'ä¸­è¯äººæ°‘å…±å’Œåœ‹')">ğŸš€ ç¶œåˆ</button>
                        </div>
                        <div class="unit-submenu" style="display: block;">
                            <div class="unit-sub-item" onclick="openModeModal('u_1768480267921_ljl5n', 'å»ºåœ‹åˆå¹´(1949-1952)')">å»ºåœ‹åˆå¹´(1949-1952)</div><div class="unit-sub-item" onclick="openModeModal('u_1768480267921_4wm4b', 'ç¤¾æœƒä¸»ç¾©æ”¹é€ èˆ‡ä¸€äº”è¨ˆåŠƒ(1953-1957)')">ç¤¾æœƒä¸»ç¾©æ”¹é€ èˆ‡ä¸€äº”è¨ˆåŠƒ(1953-1957)</div><div class="unit-sub-item" onclick="openModeModal('u_1768480267921_8x6fs', 'å…¨é¢å»ºè¨­ç¤¾æœƒä¸»ç¾©èˆ‡ä¸‰é¢ç´…æ——(1958-1960)')">å…¨é¢å»ºè¨­ç¤¾æœƒä¸»ç¾©èˆ‡ä¸‰é¢ç´…æ——(1958-1960)</div><div class="unit-sub-item" onclick="openModeModal('u_1768480267921_wt3ju', 'èª¿æ•´æ”¿ç­–(1961-1964)')">èª¿æ•´æ”¿ç­–(1961-1964)</div><div class="unit-sub-item" onclick="openModeModal('u_1768483861832', 'æ–‡åŒ–å¤§é©å‘½(1966-1976)')">æ–‡åŒ–å¤§é©å‘½(1966-1976)</div><div class="unit-sub-item" onclick="openModeModal('u_1768483418939', 'æ”¹é©é–‹æ”¾(1978-)')">æ”¹é©é–‹æ”¾(1978-)</div>
                        </div></div>

    <div class="nav-group-title" onclick="toggleSubmenu('menu-ans', this)">
    <span>ğŸ“– æŸ¥çœ‹ç­”æ¡ˆ</span> <span class="arrow">â–¼</span>
    </div>
    <div id="menu-ans" class="nav-submenu" style="display: none;"><div class="nav-part-header">ç”²éƒ¨</div>
                        <div class="unit-group-title">
                            <div class="unit-click-area" onclick="toggleUnitSubmenu(this)">
                                <span>å¤å•†å‘¨</span>
                                <span class="arrow">â–¼</span>
                            </div>
                        </div>
                        <div class="unit-submenu">
                            <div class="unit-sub-item" onclick="showAnswers('u_1768479449174_lx1pi')">å…©æ¬¡åˆ†å°</div><div class="unit-sub-item" onclick="showAnswers('u_1768479449174_q64k1')">å°å»ºã€ç¦®æ¨‚ã€å®—æ³•åˆ¶åº¦</div><div class="unit-sub-item" onclick="showAnswers('u_1768479449174_riz5p')">æ˜¥ç§‹æˆ°åœ‹çš„æ”¿æ²»è®Šå‹•</div><div class="unit-sub-item" onclick="showAnswers('u_1768479449174_ght5l')">æ˜¥ç§‹æˆ°åœ‹çš„ç¤¾æœƒè®Šå‹•</div>
                        </div>
                        <div class="unit-group-title">
                            <div class="unit-click-area" onclick="toggleUnitSubmenu(this)">
                                <span>ç§¦æ¼¢</span>
                                <span class="arrow">â–¼</span>
                            </div>
                        </div>
                        <div class="unit-submenu">
                            <div class="unit-sub-item" onclick="showAnswers('u_1768479449174_mdm59')">ç§¦å§‹çš‡çš„çµ±æ²»æ€æƒ³</div><div class="unit-sub-item" onclick="showAnswers('u_1768479449174_mvexj')">ç§¦å§‹çš‡çš„çµ±æ²»æ”¿ç­–</div><div class="unit-sub-item" onclick="showAnswers('u_1768479449174_mzdgb')">æ¼¢æ­¦å¸çš„çµ±æ²»æ€æƒ³</div><div class="unit-sub-item" onclick="showAnswers('u_1768479449174_v115d')">æ¼¢æ­¦å¸çš„çµ±æ²»æ”¿ç­–</div>
                        </div>
                        <div class="unit-group-title">
                            <div class="unit-click-area" onclick="toggleUnitSubmenu(this)">
                                <span>éš‹å”</span>
                                <span class="arrow">â–¼</span>
                            </div>
                        </div>
                        <div class="unit-submenu">
                            <div class="unit-sub-item" onclick="showAnswers('u_1768479449174_r9vo5')">é–‹çš‡ä¹‹æ²»</div><div class="unit-sub-item" onclick="showAnswers('u_1768479449174_pd40w')">è²è§€ä¹‹æ²»</div><div class="unit-sub-item" onclick="showAnswers('u_1768479449174_3f9yh')">é–‹å…ƒä¹‹æ²»</div><div class="unit-sub-item" onclick="showAnswers('u_1768479449174_hujez')">å®‰å²ä¹‹äº‚</div>
                        </div>
                        <div class="unit-group-title">
                            <div class="unit-click-area" onclick="toggleUnitSubmenu(this)">
                                <span>å®‹å…ƒæ˜æ¸…</span>
                                <span class="arrow">â–¼</span>
                            </div>
                        </div>
                        <div class="unit-submenu">
                            <div class="unit-sub-item" onclick="showAnswers('u_1768479449174_prib8')">æ˜å¤ªç¥–çš„å›ä¸»é›†æ¬Š</div><div class="unit-sub-item" onclick="showAnswers('u_1768479449174_zgj24')">æ˜æˆç¥–çš„å›ä¸»é›†æ¬Š</div><div class="unit-sub-item" onclick="showAnswers('u_1768479449174_p5r8r')">æ˜ä»£å›ä¸»é›†æ¬Šçš„æˆæ•ˆèˆ‡æµå¼Š</div>
                        </div><div class="nav-part-header">ä¹™éƒ¨</div>
                        <div class="unit-group-title">
                            <div class="unit-click-area" onclick="toggleUnitSubmenu(this)">
                                <span>ä¸­è¯äººæ°‘å…±å’Œåœ‹</span>
                                <span class="arrow">â–¼</span>
                            </div>
                        </div>
                        <div class="unit-submenu">
                            <div class="unit-sub-item" onclick="showAnswers('u_1768480267921_ljl5n')">å»ºåœ‹åˆå¹´(1949-1952)</div><div class="unit-sub-item" onclick="showAnswers('u_1768480267921_4wm4b')">ç¤¾æœƒä¸»ç¾©æ”¹é€ èˆ‡ä¸€äº”è¨ˆåŠƒ(1953-1957)</div><div class="unit-sub-item" onclick="showAnswers('u_1768480267921_8x6fs')">å…¨é¢å»ºè¨­ç¤¾æœƒä¸»ç¾©èˆ‡ä¸‰é¢ç´…æ——(1958-1960)</div><div class="unit-sub-item" onclick="showAnswers('u_1768480267921_wt3ju')">èª¿æ•´æ”¿ç­–(1961-1964)</div><div class="unit-sub-item" onclick="showAnswers('u_1768483861832')">æ–‡åŒ–å¤§é©å‘½(1966-1976)</div><div class="unit-sub-item" onclick="showAnswers('u_1768483418939')">æ”¹é©é–‹æ”¾(1978-)</div>
                        </div></div>

    <div class="nav-group-title" onclick="showHistoryView()">
        <span>ğŸ† ä½ çš„è¨˜éŒ„</span>
    </div>
    
    <div class="nav-group-title" onclick="showGeneratorView()">
        <span>ğŸ› ï¸ å‡ºé¡Œèˆ‡ç®¡ç†</span>
    </div>
</div>

<div id="mode-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <h3 id="modal-title">æ–‡åŒ–å¤§é©å‘½(1966-1976)</h3>
        <p style="color: #666; margin-bottom: 20px;">è«‹é¸æ“‡æ‚¨æƒ³è¦çš„æ¸¬é©—æ–¹å¼</p>
        <button class="mode-btn primary" onclick="startQuiz('sequential')">é †åºå‡ºé¡Œ (1, 2, 3...)</button>
        <button class="mode-btn" onclick="startQuiz('random')">éš¨æ©Ÿå‡ºé¡Œ (äº‚æ•¸æ’åº)</button>
        <button style="margin-top: 10px; background:none; border:none; text-decoration:underline; color:#666;" onclick="closeModal('mode-modal')">å–æ¶ˆ</button>
    </div>
</div>

<div id="mixed-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <h3 id="mixed-modal-title" style="color:var(--primary); margin-bottom:10px;">ğŸš€ ä¸­è¯äººæ°‘å…±å’Œåœ‹ - ç¶œåˆæ¸¬é©—</h3>
        <p style="font-size:14px; color:#666; margin-bottom:10px;">è«‹å‹¾é¸è¦æ¶µè“‹çš„å­å–®å…ƒï¼š</p>
        
        <div id="mixed-checkbox-container" class="checkbox-list"><div class="checkbox-item">
                <label style="flex:1; cursor:pointer; display:flex; align-items:center;">
                    <input type="checkbox" value="u_1768480267921_ljl5n" checked="" onchange="updateMixedTotalCount()">
                    å»ºåœ‹åˆå¹´(1949-1952) <span style="font-size:12px; color:#888; margin-left:5px;">(20é¡Œ)</span>
                </label></div><div class="checkbox-item">
                <label style="flex:1; cursor:pointer; display:flex; align-items:center;">
                    <input type="checkbox" value="u_1768480267921_4wm4b" checked="" onchange="updateMixedTotalCount()">
                    ç¤¾æœƒä¸»ç¾©æ”¹é€ èˆ‡ä¸€äº”è¨ˆåŠƒ(1953-1957) <span style="font-size:12px; color:#888; margin-left:5px;">(20é¡Œ)</span>
                </label></div><div class="checkbox-item">
                <label style="flex:1; cursor:pointer; display:flex; align-items:center;">
                    <input type="checkbox" value="u_1768480267921_8x6fs" checked="" onchange="updateMixedTotalCount()">
                    å…¨é¢å»ºè¨­ç¤¾æœƒä¸»ç¾©èˆ‡ä¸‰é¢ç´…æ——(1958-1960) <span style="font-size:12px; color:#888; margin-left:5px;">(20é¡Œ)</span>
                </label></div><div class="checkbox-item">
                <label style="flex:1; cursor:pointer; display:flex; align-items:center;">
                    <input type="checkbox" value="u_1768480267921_wt3ju" checked="" onchange="updateMixedTotalCount()">
                    èª¿æ•´æ”¿ç­–(1961-1964) <span style="font-size:12px; color:#888; margin-left:5px;">(20é¡Œ)</span>
                </label></div><div class="checkbox-item">
                <label style="flex:1; cursor:pointer; display:flex; align-items:center;">
                    <input type="checkbox" value="u_1768483861832" checked="" onchange="updateMixedTotalCount()">
                    æ–‡åŒ–å¤§é©å‘½(1966-1976) <span style="font-size:12px; color:#888; margin-left:5px;">(30é¡Œ)</span>
                </label></div><div class="checkbox-item">
                <label style="flex:1; cursor:pointer; display:flex; align-items:center;">
                    <input type="checkbox" value="u_1768483418939" checked="" onchange="updateMixedTotalCount()">
                    æ”¹é©é–‹æ”¾(1978-) <span style="font-size:12px; color:#888; margin-left:5px;">(30é¡Œ)</span>
                </label></div></div>

        <div style="text-align:left; margin-bottom:5px;">
            <label style="font-weight:bold; font-size:14px;">æƒ³è¦ç·´ç¿’é¡Œæ•¸ï¼š</label>
        </div>
        <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px;">
            <input type="number" id="mixed-q-count" class="mode-btn" style="padding:10px; margin:0; flex:1;" value="10" min="1" max="140">
            <span style="font-size:13px; color:#666;" id="mixed-max-count">å…± 140 é¡Œå¯ç”¨</span>
        </div>

        <button class="mode-btn primary" onclick="startMixedQuiz()">é–‹å§‹ç¶œåˆæ¸¬é©—</button>
        <button style="margin-top: 10px; background:none; border:none; text-decoration:underline; color:#666;" onclick="closeModal('mixed-modal')">å–æ¶ˆ</button>
    </div>
</div>

<div id="edit-question-modal" class="modal" style="display: none;">
    <div class="modal-content" style="text-align: left;">
        <h3 style="color:var(--info); text-align:center; margin-bottom:15px;">âœï¸ ç·¨è¼¯é¡Œç›®</h3>
        
        <div class="edit-form-row">
            <label class="edit-form-label">å•é¡Œå…§å®¹ï¼š</label>
            <textarea id="edit-q-text" class="edit-form-textarea" style="height:80px;"></textarea>
        </div>
        <div class="edit-form-row">
            <label class="edit-form-label">é¸é … Aï¼š</label>
            <input type="text" id="edit-opt-1" class="edit-form-input">
        </div>
        <div class="edit-form-row">
            <label class="edit-form-label">é¸é … Bï¼š</label>
            <input type="text" id="edit-opt-2" class="edit-form-input">
        </div>
        <div class="edit-form-row">
            <label class="edit-form-label">é¸é … Cï¼š</label>
            <input type="text" id="edit-opt-3" class="edit-form-input">
        </div>
        <div class="edit-form-row">
            <label class="edit-form-label">é¸é … Dï¼š</label>
            <input type="text" id="edit-opt-4" class="edit-form-input">
        </div>
        <div class="edit-form-row">
            <label class="edit-form-label">æ­£ç¢ºç­”æ¡ˆï¼š</label>
            <select id="edit-q-ans" class="edit-form-input">
                <option value="1">A</option>
                <option value="2">B</option>
                <option value="3">C</option>
                <option value="4">D</option>
            </select>
        </div>
        <div class="edit-form-row">
            <label class="edit-form-label">è§£æï¼š</label>
            <textarea id="edit-q-exp" class="edit-form-textarea"></textarea>
        </div>

        <button class="mode-btn primary" onclick="saveEditedQuestion()">ä¿å­˜ä¿®æ”¹</button>
        <button style="margin-top: 10px; background:none; border:none; text-decoration:underline; color:#666; width:100%;" onclick="closeModal('edit-question-modal')">å–æ¶ˆ</button>
    </div>
</div>
<div id="view-welcome" class="view-section" style="text-align:center; padding-top: 10vh;">
    <h1 style="color: #1a237e; margin-bottom: 20px;">æ­·å²éš¨èº«æ¸¬</h1>
    
    <p style="color: #666; font-size: 1.2em;">
        æ­¡è¿å›ä¾†ï¼<br>
        è«‹é»æ“Š <b>å·¦ä¸Šè§’é¸å–® (â˜°)</b> é¸æ“‡åŠŸèƒ½
    </p>

    <div id="egg-container" style="margin-top: 30px; min-height: 100px;">
        <h3 style="color:#ff9800; font-size:1em;">ğŸ† æˆå°±è§£é–</h3>
        <div id="egg-gallery" style="display:flex; justify-content:center; flex-wrap:wrap; gap:10px; max-width: 600px; margin: 0 auto;">
            <span style="color:#ccc; font-size:0.9em;">(æ¯å®Œæˆ 10% é€²åº¦ï¼Œå³å¯è§£é–ä¸€å¼µå½©è›‹åœ–)</span>
        </div>
    </div>
    <div style="font-size: 4em; color: #ff9800; margin-top: 30px;">â†–</div>
</div>
<div id="view-quiz" class="view-section">
    <div class="card">
        <div class="quiz-header">
            <span id="quiz-unit-name">æ–‡åŒ–å¤§é©å‘½(1966-1976)</span>
            <span id="quiz-counter">1 / 0</span>
        </div>
        
        <div id="quiz-container"><div class="question-text">å·¥æ¥­èª¿æ•´æ”¿ç­–ä¸­ï¼Œä¼æ¥­å¯¦æ–½ã€Œè‡ªè² ç›ˆè™§ã€çš„ç›®çš„æ˜¯</div><button class="option-btn disabled" onclick="checkAnswer(this, 1)">A. è®“å·¥å» å€’é–‰</button><button class="option-btn disabled" onclick="checkAnswer(this, 2)">B. å¯¦è¡Œå…¨é¢ç§æœ‰åŒ–</button><button class="option-btn disabled" onclick="checkAnswer(this, 3)">C. ä¸‹æ”¾ç¶“ç‡Ÿæ¬Šï¼Œé¼“å‹µä¼æ¥­é‡è¦–æ•ˆç›Šèˆ‡ç”Ÿç”¢å‹•åŠ›</button><button class="option-btn disabled" onclick="checkAnswer(this, 4)">D. å¢åŠ æ”¿åºœè² æ“”</button><div id="exp-block" class="explanation"><strong>è§£æï¼š</strong><br>éå»ä¼æ¥­è™§æå…¨ç”±æ”¿åºœæ‰¿æ“”ï¼Œç¼ºä¹æ•ˆç‡ã€‚èª¿æ•´å¾Œä¸‹æ”¾ç®¡ç†æ¬Šçµ¦å» é•·èˆ‡å“¡å·¥ï¼Œé‡è¦–ç¶“æ¿Ÿæ•ˆç›Šï¼ŒæˆåŠŸè®“å·¥æ¥­ç”¢é‡å›å‡ã€‚</div></div>

        <button id="next-btn" class="next-btn" onclick="nextQuestion()" style="display: none;">ä¸‹ä¸€é¡Œ</button>
    </div>
</div>

<div id="view-result" class="view-section">
    <div class="card" style="text-align: center;">
        <div style="width: 100px; height: 100px; background: var(--primary); color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 28px; font-weight: bold; margin: 0 auto 20px;">
            <span id="final-score">100%</span>
        </div>
        <h3>æ¸¬é©—å®Œæˆ</h3>
        <p id="result-msg">åšå¾—å¥½ï¼</p>
        <button class="mode-btn primary" onclick="showHistoryView()">æŸ¥çœ‹è¨˜éŒ„èˆ‡éŒ¯é¡Œ</button>
        <button class="mode-btn" onclick="location.reload()">å›åˆ°é¦–é </button>
    </div>
</div>

<div id="view-answers" class="view-section">
    <div class="card">
        <h3 id="ans-unit-title" style="color: var(--primary); border-bottom: 2px solid var(--primary); padding-bottom: 10px; margin-bottom: 20px;">ç§¦å§‹çš‡çš„çµ±æ²»æ€æƒ³ - å®Œæ•´è§£æ</h3>
        <div id="ans-list">
                <div class="ans-item">
                    <div style="font-weight:bold; margin-bottom:5px; font-size:16px;">
                        <span style="color:var(--primary);">1.</span> ç§¦å§‹çš‡ç”Ÿæ€§å¤šç–‘ã€åˆ»è–„å¯¡æ©ï¼Œé€™ç¨®æ€§æ ¼ç‰¹è³ªèˆ‡å…¶æ—©å¹´å“ªæ®µç¶“æ­·æœ€ç›´æ¥ç›¸é—œï¼Ÿ
                    </div>
                    
                    <div style="margin: 10px 0 15px 15px;"><div style="color:#666;; margin-bottom:4px;">A. é•·æœŸé ˜å…µå¾æˆ°å…­åœ‹</div><div style="color:#2e7d32; font-weight:bold;; margin-bottom:4px;">B. æ›¾æ–¼è¶™åœ‹ç‚ºäººè³ªï¼Œä¸¦é­ç›¸çˆ¶å‘‚ä¸éŸ‹æ¬ºç</div><div style="color:#666;; margin-bottom:4px;">C. å—å„’å®¶ã€Œæ€§æƒ¡è«–ã€çš„è–°é™¶</div><div style="color:#666;; margin-bottom:4px;">D. å…­åœ‹éºæ°‘å¤šæ¬¡å°å…¶é€²è¡Œåˆºæ®º</div></div>

                    <div style="color:var(--success); font-weight:bold; margin-bottom:5px;">
                        âœ… æ­£ç¢ºç­”æ¡ˆï¼šB
                    </div>
                    <div style="font-size:14px; color:#444; background:#f0f4c3; padding:12px; border-radius:8px; line-height:1.5;">
                        ğŸ’¡ <strong>è§£æï¼š</strong><br>ç§¦å§‹çš‡æ—©å¹´çš„å€‹äººç¶“æ­·æ·±åˆ»å½±éŸ¿äº†å…¶æ²»åœ‹é¢¨æ ¼ã€‚ä»–æ›¾åœ¨è¶™åœ‹æ“”ä»»äººè³ªï¼Œæ­¸åœ‹å¾Œåˆé¢è‡¨ç›¸çˆ¶å‘‚ä¸éŸ‹çš„æ¬ŠåŠ›å¨è„…èˆ‡æ¬ºçï¼Œé€™ä½¿ä»–ç™¼å±•å‡ºå¤šç–‘ã€åˆ»è–„ä¸”ä¸è¼•ä¿¡äººçš„æ€§æ ¼ã€‚æ³•å®¶ä¸»å¼µå›æ¬Šè‡³ä¸Šã€é€éæ³•å¾‹å¼·åŒ–å›ä¸»å¨æ¬Šï¼Œæ­£å¥½å¥‘åˆä»–æ¸´æœ›çµ•å°æŒæ§å…¨åœ‹çš„çµ±æ²»å¿ƒç†ã€‚
                    </div>
                </div>
            
                <div class="ans-item">
                    <div style="font-weight:bold; margin-bottom:5px; font-size:16px;">
                        <span style="color:var(--primary);">2.</span> ç§¦å§‹çš‡é¸æ“‡æ³•å®¶æ€æƒ³æ²»åœ‹ï¼Œå…¶ã€Œå› æ™‚åˆ¶å®œã€çš„ç¾å¯¦è€ƒé‡ç‚ºä½•ï¼Ÿ
                    </div>
                    
                    <div style="margin: 10px 0 15px 15px;"><div style="color:#666;; margin-bottom:4px;">A. ç•¶æ™‚å¤©ä¸‹å¤ªå¹³ï¼Œéœ€è¦åš´å¯†æ³•å¾‹ç¶­æŒç§©åº</div><div style="color:#2e7d32; font-weight:bold;; margin-bottom:4px;">B. å…­åœ‹éºæ°‘å¤šæ‡·äº¡åœ‹ä¹‹æ¨ï¼Œå¯†è¬€å¾©åœ‹ï¼Œéœ€ä»¥é«˜å£“æ‰‹æ®µå£“åˆ¶</div><div style="color:#666;; margin-bottom:4px;">C. ç‚ºäº†èˆ‡å‘¨æœçš„å°å»ºç¦®æ²»é€²è¡Œæ–‡åŒ–å°æ¥</div><div style="color:#666;; margin-bottom:4px;">D. æ³•å®¶å…·å‚™æ°‘ä¸»æ€æƒ³ï¼Œæœ‰åˆ©æ–¼åŸºå±¤è‡ªæ²»</div></div>

                    <div style="color:var(--success); font-weight:bold; margin-bottom:5px;">
                        âœ… æ­£ç¢ºç­”æ¡ˆï¼šB
                    </div>
                    <div style="font-size:14px; color:#444; background:#f0f4c3; padding:12px; border-radius:8px; line-height:1.5;">
                        ğŸ’¡ <strong>è§£æï¼š</strong><br>ç§¦æœä»¥æ­¦åŠ›ä½µåå…­åœ‹ï¼Œæ”¿æ¬Šå»ºç«‹ä¹‹åˆå¤§å±€æœªå®šã€‚å…­åœ‹éºæ°‘æ™®éæ‡·æœ‰äº¡åœ‹ä¹‹æ¨ï¼Œä¸”æš—ä¸­è¬€åŠƒå¾©åœ‹è¡Œå‹•ã€‚æ³•å®¶æå€¡ä¸­å¤®é›†æ¬Šèˆ‡å²è¡Œåˆ‘æ³•ï¼Œé€™å°ç§¦å§‹çš‡ä¾†èªªï¼Œæ˜¯å£“åˆ¶éºæ°‘ç•°å¿ƒã€ç©©å®šæ–°é ˜åœŸæœ€æœ‰æ•ˆçš„æ”¿æ²»å·¥å…·ï¼Œå±¬æ–¼æ‡‰å°å±€å‹¢çš„ç¾å¯¦æŠ‰æ“‡ã€‚
                    </div>
                </div>
            
                <div class="ans-item">
                    <div style="font-weight:bold; margin-bottom:5px; font-size:16px;">
                        <span style="color:var(--primary);">3.</span> ç§¦å§‹çš‡å°æ³•å®¶å­¸èªªçš„ä¿¡ä»»ï¼Œä¸»è¦å€Ÿé‘‘äº†ç§¦åœ‹å“ªä½å‰ä»£çš„æ”¹é©ç¶“é©—ï¼Ÿ
                    </div>
                    
                    <div style="margin: 10px 0 15px 15px;"><div style="color:#666;; margin-bottom:4px;">A. ç§¦ç©†å…¬ä»»ç”¨ç™¾é‡Œå¥š</div><div style="color:#666;; margin-bottom:4px;">B. ç§¦æƒ æ–‡ç‹ä»»ç”¨å¼µå„€</div><div style="color:#2e7d32; font-weight:bold;; margin-bottom:4px;">C. ç§¦å­å…¬ä»»ç”¨å•†é…</div><div style="color:#666;; margin-bottom:4px;">D. ç§¦æ˜­è¥„ç‹ä»»ç”¨èŒƒé›</div></div>

                    <div style="color:var(--success); font-weight:bold; margin-bottom:5px;">
                        âœ… æ­£ç¢ºç­”æ¡ˆï¼šC
                    </div>
                    <div style="font-size:14px; color:#444; background:#f0f4c3; padding:12px; border-radius:8px; line-height:1.5;">
                        ğŸ’¡ <strong>è§£æï¼š</strong><br>ç§¦åœ‹çš„å¼·å¤§åŸºç¤æºæ–¼ç§¦å­å…¬æ™‚æœŸå•†é…æ‰€æ¨è¡Œçš„è®Šæ³•ã€‚å•†é…è®Šæ³•å¯¦è¡Œæ³•æ²»èˆ‡ä¸­å¤®é›†æ¬Šï¼Œä½¿ç§¦åœ‹è¿…é€Ÿå¯Œå¼·ä¸¦åœ¨æˆ°çˆ­ä¸­å±¢æˆ°å±¢å‹ã€‚ç§¦å§‹çš‡è¦‹è­‰äº†æ²¿ç”¨æ³•å®¶å­¸èªªå°æå‡åœ‹åŠ›ã€çµ±ä¸€å…­åœ‹çš„é¡¯è‘—åŠŸæ•ˆï¼Œå› æ­¤åœ¨çµ±ä¸€å¤©ä¸‹å¾Œé¸æ“‡ç¹¼çºŒå¾¹åº•åŸ·è¡Œã€‚
                    </div>
                </div>
            
                <div class="ans-item">
                    <div style="font-weight:bold; margin-bottom:5px; font-size:16px;">
                        <span style="color:var(--primary);">4.</span> æ³•å®¶æ€æƒ³ä¸­å“ªä¸€é …ç†è«–æœ€ç¬¦åˆç§¦å§‹çš‡å°ã€Œå¤§ä¸€çµ±ã€æ ¼å±€çš„è¿½æ±‚ï¼Ÿ
                    </div>
                    
                    <div style="margin: 10px 0 15px 15px;"><div style="color:#666;; margin-bottom:4px;">A. æ°‘è²´å›è¼•çš„æ°‘æœ¬æ€æƒ³</div><div style="color:#2e7d32; font-weight:bold;; margin-bottom:4px;">B. å›ä¸»å¨æ¬Šè‡³é«˜ç„¡ä¸Šï¼Œæ¬ŠåŠ›é›†ä¸­æ–¼ä¸­å¤®</div><div style="color:#666;; margin-bottom:4px;">C. æ¢å¾©å¤å•†å‘¨çš„å°å»ºåˆ¶åº¦</div><div style="color:#666;; margin-bottom:4px;">D. æå€¡é“æ³•è‡ªç„¶ï¼Œèˆ‡æ°‘ä¼‘æ¯</div></div>

                    <div style="color:var(--success); font-weight:bold; margin-bottom:5px;">
                        âœ… æ­£ç¢ºç­”æ¡ˆï¼šB
                    </div>
                    <div style="font-size:14px; color:#444; background:#f0f4c3; padding:12px; border-radius:8px; line-height:1.5;">
                        ğŸ’¡ <strong>è§£æï¼š</strong><br>ç§¦å§‹çš‡è¿½æ±‚çš„æ˜¯å°‡æ¬ŠåŠ›æ”¶æ­¸ä¸­å¤®ï¼Œæ‰“ç ´åœ°æ–¹å‰²æ“šã€‚æ³•å®¶æ ¸å¿ƒä¸»å¼µå›ä¸»æ‡‰æŒæ¡çµ•å°å¨æ¬Šï¼Œé€éå®˜åƒšé«”ç³»ç®¡ç†å…¨åœ‹è‡£æ°‘ã€‚é€™å¥—æ€æƒ³ç‚ºå…¶å»¢é™¤å°å»ºã€æ”¹è¡Œéƒ¡ç¸£åˆ¶æä¾›äº†ç†è«–ä¾æ“šï¼Œå¥ å®šäº†ä¸­åœ‹å…©åƒå¤šå¹´çš„ä¸­å¤®é›†æ¬Šæ”¿æ²»æ¨¡å¼ã€‚
                    </div>
                </div>
            
                <div class="ans-item">
                    <div style="font-weight:bold; margin-bottom:5px; font-size:16px;">
                        <span style="color:var(--primary);">5.</span> é—œæ–¼ç§¦å§‹çš‡å¯¦è¡Œæ³•å®¶çµ±æ²»çš„å„ªé»ï¼Œä¸‹åˆ—æ•˜è¿°ä½•è€…æœ€è²¼åˆ‡ï¼Ÿ
                    </div>
                    
                    <div style="margin: 10px 0 15px 15px;"><div style="color:#666;; margin-bottom:4px;">A. èƒ½å¤ è´å¾—å…­åœ‹ç™¾å§“çš„çœŸå¿ƒæ„›æˆ´</div><div style="color:#2e7d32; font-weight:bold;; margin-bottom:4px;">B. æœ‰åŠ©æ–¼åœ¨å‹•ç›ªåˆæœŸçµ±ä¸€æ³•ä»¤ï¼Œéœ‡æ‡¾åæŠ—å‹¢åŠ›</div><div style="color:#666;; margin-bottom:4px;">C. ä¿ƒé€²äº†å„å®¶å­¸èªªåœ¨å„åœ°çš„è‡ªç”±å‚³æ’­</div><div style="color:#666;; margin-bottom:4px;">D. æ¸›è¼•äº†è¾²æ°‘çš„è³¦ç¨…èˆ‡å‹å½¹è² æ“”</div></div>

                    <div style="color:var(--success); font-weight:bold; margin-bottom:5px;">
                        âœ… æ­£ç¢ºç­”æ¡ˆï¼šB
                    </div>
                    <div style="font-size:14px; color:#444; background:#f0f4c3; padding:12px; border-radius:8px; line-height:1.5;">
                        ğŸ’¡ <strong>è§£æï¼š</strong><br>åœ¨ç§¦æœåˆå»ºã€åœ°æ–¹åæŠ—åŠ›é‡è ¢è ¢æ¬²å‹•çš„èƒŒæ™¯ä¸‹ï¼Œçµ±ä¸€çš„æ³•ä»¤èˆ‡å¨æ‡¾æ€§çš„åˆ‘ç½°æœ‰åˆ©æ–¼å»ºç«‹ä¸­å¤®æ¬Šå¨ã€‚é›–ç„¶é€™ç¨®çµ±æ²»æ‰‹æ®µæ¥µå…¶åš´è‹›ï¼Œä½†åœ¨çŸ­æœŸå…§ç¢ºå¯¦ç™¼æ®äº†å£“åˆ¶éºæ°‘ç•°å¿ƒã€é˜²ç¯„åœ°æ–¹å›äº‚çš„ä½œç”¨ï¼ŒåŠ å¼·äº†å°å…¨å¢ƒè‡£æ°‘çš„åˆæ­¥çµ±æ²»ã€‚
                    </div>
                </div>
            
                <div class="ans-item">
                    <div style="font-weight:bold; margin-bottom:5px; font-size:16px;">
                        <span style="color:var(--primary);">6.</span> ç§¦å§‹çš‡è‡ªè©¡ã€ŒåŠŸéä¸‰çš‡ï¼Œå¾·å…¼äº”å¸ã€ï¼Œé€™åæ˜ äº†ä»–å°å›ä¸»åœ°ä½ä½•ç¨®æœŸå¾…ï¼Ÿ
                    </div>
                    
                    <div style="margin: 10px 0 15px 15px;"><div style="color:#666;; margin-bottom:4px;">A. å¸Œæœ›èˆ‡å…ˆè–å…ˆç‹å¹³èµ·å¹³å</div><div style="color:#2e7d32; font-weight:bold;; margin-bottom:4px;">B. ç¢ºç«‹è¶…è¶Šæ­·å²çš„å¨æ¬Šï¼Œå¥ å®šçš‡å¸è‡³é«˜ç„¡ä¸Šçš„åœ°ä½</div><div style="color:#666;; margin-bottom:4px;">C. å¼·èª¿å›è‡£å¹³ç­‰ï¼Œå¯¦è¡Œå…±æ²»</div><div style="color:#666;; margin-bottom:4px;">D. åƒ…æ˜¯ç‚ºäº†ä¿®é£¾å…¶å­¸è¡“ä¿®é¤Š</div></div>

                    <div style="color:var(--success); font-weight:bold; margin-bottom:5px;">
                        âœ… æ­£ç¢ºç­”æ¡ˆï¼šB
                    </div>
                    <div style="font-size:14px; color:#444; background:#f0f4c3; padding:12px; border-radius:8px; line-height:1.5;">
                        ğŸ’¡ <strong>è§£æï¼š</strong><br>ç§¦å§‹çš‡å‰µç«‹ã€Œçš‡å¸ã€ç¨±è™Ÿï¼Œè‡ªç¨±ã€Œå§‹çš‡å¸ã€ï¼Œä¸¦è¦å®šå¤©å­è‡ªç¨±ã€Œæœ•ã€ï¼Œçš†æ˜¯ç‚ºäº†å½°é¡¯è‡ªå·±å‰ç„¡å¤äººçš„åŠŸç¸¾ã€‚é€éåè™Ÿçš„ç¢ºç«‹ï¼Œä»–æˆåŠŸæ§‹å»ºäº†çš‡å¸å¨æ¬Šç¥è–ä¸å¯ä¾µçŠ¯çš„å½¢è±¡ï¼Œåœ¨å¿ƒç†èˆ‡åˆ¶åº¦ä¸Šéœ‡æ‡¾äº†å…­åœ‹éºæ°‘ã€‚
                    </div>
                </div>
            
                <div class="ans-item">
                    <div style="font-weight:bold; margin-bottom:5px; font-size:16px;">
                        <span style="color:var(--primary);">7.</span> ç§¦å§‹çš‡åˆ©ç”¨ã€Œäº”å¾·çµ‚å§‹èªªã€å®£ç¨±ç§¦æœç‚ºã€Œæ°´å¾·ã€ï¼Œå…¶æ”¿æ²»ç›®çš„æ˜¯
                    </div>
                    
                    <div style="margin: 10px 0 15px 15px;"><div style="color:#666;; margin-bottom:4px;">A. æ¨å»£ç§‘å­¸åœ°ç†çŸ¥è­˜</div><div style="color:#2e7d32; font-weight:bold;; margin-bottom:4px;">B. è­‰æ˜ç§¦æœå–ä»£å‘¨æœæ˜¯æ­£çµ±ã€å—å‘½æ–¼å¤©</div><div style="color:#666;; margin-bottom:4px;">C. é¼“å‹µç™¾å§“åŠ å¼·æ°´åˆ©å·¥ç¨‹å»ºè¨­</div><div style="color:#666;; margin-bottom:4px;">D. èˆ‡å„’å®¶çš„ä»æ”¿æ€æƒ³ç›¸å‘¼æ‡‰</div></div>

                    <div style="color:var(--success); font-weight:bold; margin-bottom:5px;">
                        âœ… æ­£ç¢ºç­”æ¡ˆï¼šB
                    </div>
                    <div style="font-size:14px; color:#444; background:#f0f4c3; padding:12px; border-radius:8px; line-height:1.5;">
                        ğŸ’¡ <strong>è§£æï¼š</strong><br>ç§¦å§‹çš‡åˆ©ç”¨äº”å¾·å­¸èªªï¼Œç¨±å‘¨æœç‚ºç«å¾·ï¼Œè€Œç§¦ä»¥æ°´å‰‹ç«ã€‚é€™ç¨®è«–è¿°è³¦äºˆäº†ç§¦æœçµ±æ²»ç¥è–çš„åˆæ³•æ€§èˆ‡æ­£çµ±æ€§ï¼Œå‘å¤©ä¸‹å®£å‘Šç§¦æœå»ºç«‹æ˜¯å¤©æ„æ‰€æ­¸ï¼Œé€²ä¸€æ­¥å¼·åŒ–äº†çš‡å¸å¨æ¬Šçš„åˆæ³•æ€§æ ¹åŸºã€‚
                    </div>
                </div>
            
                <div class="ans-item">
                    <div style="font-weight:bold; margin-bottom:5px; font-size:16px;">
                        <span style="color:var(--primary);">8.</span> ç§¦æœæ³•å®¶æ€æƒ³æ²»ç†ä¸‹çš„å®˜å“¡é«”ç³»å…·å‚™ä½•ç¨®ç‰¹è‰²ï¼Ÿ
                    </div>
                    
                    <div style="margin: 10px 0 15px 15px;"><div style="color:#2e7d32; font-weight:bold;; margin-bottom:4px;">A. å®˜å“¡çš†ç”±çš‡å¸ä»»å…ï¼Œå‘çš‡å¸è² è²¬ï¼Œä¸å¾—ä¸–è¥²</div><div style="color:#666;; margin-bottom:4px;">B. åœ°æ–¹é•·å®˜å¯ä»¥è‡ªè¡Œæ‹›å‹Ÿè»éšŠï¼Œä¸éœ€å‘ˆå ±</div><div style="color:#666;; margin-bottom:4px;">C. ä¸ç›¸æ“æœ‰èˆ‡çš‡å¸åŒç­‰çš„æ±ºç­–æ¬Š</div><div style="color:#666;; margin-bottom:4px;">D. å®˜å“¡å¿…é ˆå‡ºèº«æ–¼å…­åœ‹èˆŠè²´æ—</div></div>

                    <div style="color:var(--success); font-weight:bold; margin-bottom:5px;">
                        âœ… æ­£ç¢ºç­”æ¡ˆï¼šA
                    </div>
                    <div style="font-size:14px; color:#444; background:#f0f4c3; padding:12px; border-radius:8px; line-height:1.5;">
                        ğŸ’¡ <strong>è§£æï¼š</strong><br>åœ¨ä¸­å¤®é›†æ¬Šåˆ¶åº¦ä¸‹ï¼Œç§¦æœæ‰“ç ´äº†è¡€ç·£ä¸–è¥²ã€‚å®˜å“¡ç”±çš‡å¸ç›´æ¥ä»»å…ï¼Œé ˜å–åœ‹å®¶ä¿¸ç¥¿ï¼Œé€™ç¢ºä¿äº†å¤§æ¬Šé›†æ–¼çš‡å¸ä¸€èº«ï¼Œé˜²æ­¢äº†åœ°æ–¹å‹¢åŠ›æ¼”è®Šæˆç¨ç«‹çš„åˆ†è£‚æ”¿æ¬Šã€‚
                    </div>
                </div>
            
                <div class="ans-item">
                    <div style="font-weight:bold; margin-bottom:5px; font-size:16px;">
                        <span style="color:var(--primary);">9.</span> ç§¦å§‹çš‡ä»¥æ³•å®¶æ€æƒ³æ²»åœ‹å¾Œï¼Œå°ã€Œæ°‘æ„ã€æ¡å–çš„æ…‹åº¦å¤šç‚º
                    </div>
                    
                    <div style="margin: 10px 0 15px 15px;"><div style="color:#666;; margin-bottom:4px;">A. é‡è¦–ç™¾å§“ç¦ç¥‰ï¼Œæ¨è¡Œèˆ‡æ°‘ä¼‘æ¯</div><div style="color:#2e7d32; font-weight:bold;; margin-bottom:4px;">B. è³¤è¦–ç™¾å§“ï¼Œä»¥åš´åˆ‘å³»æ³•æ§åˆ¶äººæ°‘ï¼Œå¿½è¦–æ°‘å¿ƒå‘èƒŒ</div><div style="color:#666;; margin-bottom:4px;">C. å®šæœŸå¬é–‹æ°‘æ„ä»£è¡¨æœƒè­°</div><div style="color:#666;; margin-bottom:4px;">D. é¼“å‹µç™¾å§“éè­°æœæ”¿ä»¥æ”¹é€²æ–½æ”¿</div></div>

                    <div style="color:var(--success); font-weight:bold; margin-bottom:5px;">
                        âœ… æ­£ç¢ºç­”æ¡ˆï¼šB
                    </div>
                    <div style="font-size:14px; color:#444; background:#f0f4c3; padding:12px; border-radius:8px; line-height:1.5;">
                        ğŸ’¡ <strong>è§£æï¼š</strong><br>æ³•å®¶çµ±æ²»çš„æ ¸å¿ƒæ˜¯æ§åˆ¶è€Œéæ„›æ°‘ã€‚ç§¦å§‹çš‡é›–ç„¶ç¢ºç«‹äº†å¨æ¬Šï¼Œä½†ä¹Ÿå› è³¤è¦–ç™¾å§“ã€å‹å½¹æ²‰é‡ï¼Œå°è‡´äººæ°‘ç”Ÿæ´»è‰±è‹¦ã€‚å…¶ã€Œå‹•è¼’å¾—å’ã€çš„å¾‹æ³•é›–ç„¶å¼·åŒ–äº†çµ±æ²»ï¼Œå»é›£ä»¥ç²å¾—ç™¾å§“çš„æ„›æˆ´ï¼ŒåŸ‹ä¸‹äº†å¾Œä¾†ç§¦æœå´©æ½°çš„ä¼ç­†ã€‚
                    </div>
                </div>
            
                <div class="ans-item">
                    <div style="font-weight:bold; margin-bottom:5px; font-size:16px;">
                        <span style="color:var(--primary);">10.</span> æ³•å®¶æ€æƒ³å°ç§¦æœé€Ÿäº¡æ‰€è² çš„è²¬ä»»åœ¨æ–¼
                    </div>
                    
                    <div style="margin: 10px 0 15px 15px;"><div style="color:#666;; margin-bottom:4px;">A. éåº¦å¼·èª¿å„’å®¶ä»ç¾©ï¼Œå°è‡´æ”¿åºœè»Ÿå¼±</div><div style="color:#2e7d32; font-weight:bold;; margin-bottom:4px;">B. åš´åˆ‘å³»æ³•ä»¤äººäººè‡ªå±ï¼Œä¸”æš´æ”¿å¼•èµ·å®˜è¿«æ°‘å</div><div style="color:#666;; margin-bottom:4px;">C. é¼“å‹µåœ°æ–¹å°å»ºï¼Œå‰Šå¼±ä¸­å¤®æ¬ŠåŠ›</div><div style="color:#666;; margin-bottom:4px;">D. å®Œå…¨ç¦æ­¢è»äº‹æ“´å¼µï¼Œåœ‹åŠ›èç¸®</div></div>

                    <div style="color:var(--success); font-weight:bold; margin-bottom:5px;">
                        âœ… æ­£ç¢ºç­”æ¡ˆï¼šB
                    </div>
                    <div style="font-size:14px; color:#444; background:#f0f4c3; padding:12px; border-radius:8px; line-height:1.5;">
                        ğŸ’¡ <strong>è§£æï¼š</strong><br>ç§¦å§‹çš‡éåº¦è¿·ä¿¡æ³•å®¶çš„æš´åŠ›éœ‡æ‡¾ã€‚åš´è‹›çš„ã€Šç§¦å¾‹ã€‹èˆ‡æ—èª…é€£åä»¤äººäººè‡ªå±ï¼Œå®Œå…¨å¿½è¦–äº†çµ±ä¸€å¾Œç™¾å§“éœ€è¦ä¿®ç”Ÿé¤Šæ¯çš„éœ€æ±‚ã€‚æœ€çµ‚é™³å‹ã€å³å»£å› ã€Œå¤±æœŸç•¶æ–¬ã€çš„åš´è‹›æ³•å¾‹è€Œèµ·ç¾©ï¼Œè­‰æ˜é«˜å£“çµ±æ²»ç„¡æ³•ç¶­æŒé•·æ²»ä¹…å®‰ã€‚
                    </div>
                </div>
            </div>
        <button class="mode-btn" onclick="location.reload()" style="margin-top:20px;">é—œé–‰</button>
    </div>
</div>

<div id="view-history" class="view-section">
    <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h3>ğŸ“Š ç·´ç¿’è¨˜éŒ„</h3>
            <button onclick="clearHistory()" style="font-size:12px; padding:5px 10px; background:#ddd; border:none; border-radius:4px;">æ¸…é™¤æ‰€æœ‰</button>
        </div>
        <div id="history-list"><div style="text-align:center;color:#999;margin-top:50px;">ç„¡è¨˜éŒ„</div></div>
    </div>
</div>

<div id="view-generator" class="view-section active">
    
    <div class="card">
        <h3 style="color: var(--success); border-bottom: 2px solid var(--success); padding-bottom: 10px;">ğŸš€ å¿«é€Ÿå»ºç«‹çµæ§‹ (æ‰¹æ¬¡æ–°å¢)</h3>
        <div class="generator-container">
            <div style="background:#e8f5e9; padding:10px; border-radius:8px; font-size:13px; color:#2e7d32;">
                ğŸ’¡ <strong>æ ¼å¼èªªæ˜ï¼š</strong><br>
                ç›´æ¥è¼¸å…¥åç¨± = å»ºç«‹ã€Œéƒ¨ã€<br>
                --åç¨± = å»ºç«‹ã€Œå–®å…ƒã€<br>
                ----åç¨± = å»ºç«‹ã€Œå­å–®å…ƒã€
            </div>
            <textarea id="batch-structure-input" class="input-area" style="height:200px;" placeholder="ç¯„ä¾‹ï¼š
ä¹™éƒ¨(è¿‘ä»£å²)
--å·¥æ¥­é©å‘½
----ç´¡ç¹”æ¥­çš„ç™¼å±•
----äº¤é€šå·¥å…·çš„é©æ–°
ä¸™éƒ¨(ç¾ä»£å²)
--ç¬¬ä¸€æ¬¡ä¸–ç•Œå¤§æˆ°"></textarea>
            <button class="mode-btn" style="border-color:var(--success); color:var(--success);" onclick="batchCreateStructure()">æ‰¹æ¬¡å»ºç«‹çµæ§‹</button>
        </div>
    </div>

    <div class="card">
        <h3 style="color: var(--primary); border-bottom: 2px solid var(--primary); padding-bottom: 10px;">ğŸ“‚ æ–°å¢å–®å…ƒæˆ–éƒ¨ (å–®ç­†)</h3>
        <div class="generator-container">
            <div style="background:#e3f2fd; padding:10px; border-radius:8px; font-size:13px; color:#0d47a1;">
                ğŸ’¡ <strong>æç¤ºï¼š</strong><br>
                é¸æ“‡ã€Œâ• å»ºç«‹å…¨æ–°çš„éƒ¨ã€å¯æ–°å¢æœ€ä¸Šå±¤åˆ†é¡ã€‚<br>
                <strong>æ³¨æ„ï¼š</strong>è‹¥è¦æ–°å¢èƒ½å‡ºé¡Œçš„å–®å…ƒï¼Œè«‹å‹¿å‹¾é¸ã€Œè¨­ç‚ºç›®éŒ„ã€ã€‚
            </div>
            <div>
                <label style="font-size:14px; font-weight:bold; color:#555;">1. é¸æ“‡å±¤ç´š (åœ¨æ­¤ä¹‹ä¸‹æ–°å¢)ï¼š</label>
                <select id="add-unit-parent" class="mode-btn" style="padding:10px; margin:5px 0;" onchange="toggleFolderOption()"><option value="create_new_part" style="font-weight: bold; color: var(--primary);">â• å»ºç«‹å…¨æ–°çš„éƒ¨ (æ ¹ç›®éŒ„)</option><option value="root|part_1768479449174_j0foo">ğŸ“‚ ç”²éƒ¨</option><option value="group|part_1768479449174_j0foo|u_1768479449174_nr89z">ã€€â””â”€ å¤å•†å‘¨</option><option value="group|part_1768479449174_j0foo|u_1768479449174_jvdpc">ã€€â””â”€ ç§¦æ¼¢</option><option value="group|part_1768479449174_j0foo|u_1768479449174_la24y">ã€€â””â”€ éš‹å”</option><option value="group|part_1768479449174_j0foo|u_1768479449174_l18d2">ã€€â””â”€ å®‹å…ƒæ˜æ¸…</option><option value="root|part_1768480267921_9igzt">ğŸ“‚ ä¹™éƒ¨</option><option value="group|part_1768480267921_9igzt|u_1768480267921_1ryh3">ã€€â””â”€ ä¸­è¯äººæ°‘å…±å’Œåœ‹</option></select>
            </div>
            <div>
                <label style="font-size:14px; font-weight:bold; color:#555;">2. åç¨±ï¼š</label>
                <input type="text" id="add-unit-name" class="mode-btn" style="cursor:text; padding:10px; margin:5px 0;" placeholder="è¼¸å…¥åç¨±...">
            </div>
            <div id="folder-option-container" style="display: block;">
                <label style="cursor:pointer; display:flex; align-items:center; gap:8px;">
                    <input type="checkbox" id="is-folder-unit"> 
                    <span>è¨­ç‚ºã€Œç›®éŒ„ (è³‡æ–™å¤¾)ã€</span>
                </label>
                <div style="font-size:12px; color:#666; margin-left:24px; margin-top:5px;">
                    å‹¾é¸ï¼šä½œç‚ºç›®éŒ„ï¼Œéœ€å†æ–°å¢å­å–®å…ƒæ‰å¯å‡ºé¡Œã€‚<br>
                    <strong>ä¸å‹¾é¸ (é è¨­)ï¼š</strong>ç›´æ¥ä½œç‚ºæ¸¬é©—å–®å…ƒï¼Œå¯ç«‹å³å‡ºé¡Œã€‚
                </div>
            </div>
            <button class="mode-btn primary" onclick="handleAddUnit()">ç¢ºèªæ–°å¢</button>
        </div>
    </div>

    <div class="card">
        <h3 style="color: var(--warning); border-bottom: 2px solid var(--warning); padding-bottom: 10px;">ğŸ—ï¸ çµæ§‹ç®¡ç† (æ”¹å/æ’åº/åˆªé™¤)</h3>
        <div class="generator-container">
            <div style="margin-bottom:10px;">
                <label style="font-size:14px; font-weight:bold; color:#555;">é¸æ“‡è¦ç®¡ç†çš„å±¤ç´šï¼š</label>
                <select id="structure-scope-select" class="mode-btn" style="padding:10px; margin:5px 0;" onchange="renderStructureEditor()"><option value="">-- è«‹é¸æ“‡ --</option><option value="ROOT">ã€æ ¹ç›®éŒ„ã€‘ç®¡ç†ã€Œéƒ¨ã€</option><option value="PART|part_1768479449174_j0foo">ç®¡ç†ã€Œç”²éƒ¨ã€ä¸‹çš„å–®å…ƒ</option><option value="UNIT|part_1768479449174_j0foo|u_1768479449174_nr89z">ç®¡ç†ã€Œå¤å•†å‘¨ã€ä¸‹çš„å­å–®å…ƒ</option><option value="UNIT|part_1768479449174_j0foo|u_1768479449174_jvdpc">ç®¡ç†ã€Œç§¦æ¼¢ã€ä¸‹çš„å­å–®å…ƒ</option><option value="UNIT|part_1768479449174_j0foo|u_1768479449174_la24y">ç®¡ç†ã€Œéš‹å”ã€ä¸‹çš„å­å–®å…ƒ</option><option value="UNIT|part_1768479449174_j0foo|u_1768479449174_l18d2">ç®¡ç†ã€Œå®‹å…ƒæ˜æ¸…ã€ä¸‹çš„å­å–®å…ƒ</option><option value="PART|part_1768480267921_9igzt">ç®¡ç†ã€Œä¹™éƒ¨ã€ä¸‹çš„å–®å…ƒ</option><option value="UNIT|part_1768480267921_9igzt|u_1768480267921_1ryh3">ç®¡ç†ã€Œä¸­è¯äººæ°‘å…±å’Œåœ‹ã€ä¸‹çš„å­å–®å…ƒ</option></select>
            </div>
            
            <div id="structure-editor-container" style="border: 1px solid rgb(238, 238, 238); border-radius: 8px; background: rgb(250, 250, 250); display: none;"><div class="manage-item"><div class="manage-info">1. å»ºåœ‹åˆå¹´(1949-1952)</div><div class="manage-actions">
                <button class="sm-btn" onclick="manageRenameSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 0)">âœï¸</button><button class="sm-btn" onclick="manageMoveSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 0, 1)">â¬‡ï¸</button><button class="sm-btn del" onclick="manageDeleteSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 0)">ğŸ—‘ï¸</button></div></div><div class="manage-item"><div class="manage-info">2. ç¤¾æœƒä¸»ç¾©æ”¹é€ èˆ‡ä¸€äº”è¨ˆåŠƒ(1953-1957)</div><div class="manage-actions">
                <button class="sm-btn" onclick="manageRenameSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 1)">âœï¸</button><button class="sm-btn" onclick="manageMoveSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 1, -1)">â¬†ï¸</button><button class="sm-btn" onclick="manageMoveSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 1, 1)">â¬‡ï¸</button><button class="sm-btn del" onclick="manageDeleteSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 1)">ğŸ—‘ï¸</button></div></div><div class="manage-item"><div class="manage-info">3. å…¨é¢å»ºè¨­ç¤¾æœƒä¸»ç¾©èˆ‡ä¸‰é¢ç´…æ——(1958-1960)</div><div class="manage-actions">
                <button class="sm-btn" onclick="manageRenameSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 2)">âœï¸</button><button class="sm-btn" onclick="manageMoveSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 2, -1)">â¬†ï¸</button><button class="sm-btn" onclick="manageMoveSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 2, 1)">â¬‡ï¸</button><button class="sm-btn del" onclick="manageDeleteSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 2)">ğŸ—‘ï¸</button></div></div><div class="manage-item"><div class="manage-info">4. èª¿æ•´æ”¿ç­–(1961-1964)</div><div class="manage-actions">
                <button class="sm-btn" onclick="manageRenameSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 3)">âœï¸</button><button class="sm-btn" onclick="manageMoveSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 3, -1)">â¬†ï¸</button><button class="sm-btn" onclick="manageMoveSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 3, 1)">â¬‡ï¸</button><button class="sm-btn del" onclick="manageDeleteSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 3)">ğŸ—‘ï¸</button></div></div><div class="manage-item"><div class="manage-info">5. æ”¹é©é–‹æ”¾(1978-)</div><div class="manage-actions">
                <button class="sm-btn" onclick="manageRenameSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 4)">âœï¸</button><button class="sm-btn" onclick="manageMoveSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 4, -1)">â¬†ï¸</button><button class="sm-btn" onclick="manageMoveSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 4, 1)">â¬‡ï¸</button><button class="sm-btn del" onclick="manageDeleteSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 4)">ğŸ—‘ï¸</button></div></div><div class="manage-item"><div class="manage-info">6. æ–‡åŒ–å¤§é©å‘½(1966-1976)</div><div class="manage-actions">
                <button class="sm-btn" onclick="manageRenameSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 5)">âœï¸</button><button class="sm-btn" onclick="manageMoveSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 5, -1)">â¬†ï¸</button><button class="sm-btn del" onclick="manageDeleteSubUnit('part_1768480267921_9igzt', 'u_1768480267921_1ryh3', 5)">ğŸ—‘ï¸</button></div></div></div>
        </div>
    </div>

    <div class="card">
        <h3 style="color: var(--primary); border-bottom: 2px solid var(--primary); padding-bottom: 10px;">â• æ–°å¢é¡Œç›®</h3>
        <div class="generator-container">
            <div>
                <label style="font-size:14px; font-weight:bold; color:#555;">åŒ¯å…¥ç›®æ¨™å–®å…ƒï¼š</label>
                <select id="import-target-unit" class="mode-btn" style="padding:10px; margin:5px 0; border-color:var(--primary);"><option value="">-- è«‹é¸æ“‡å–®å…ƒ --</option><option value="u_1768479449174_nr89z">ğŸ“‚ å¤å•†å‘¨ (ç›®éŒ„)</option><option value="u_1768479449174_lx1pi">ã€€â””â”€ å…©æ¬¡åˆ†å°</option><option value="u_1768479449174_q64k1">ã€€â””â”€ å°å»ºã€ç¦®æ¨‚ã€å®—æ³•åˆ¶åº¦</option><option value="u_1768479449174_riz5p">ã€€â””â”€ æ˜¥ç§‹æˆ°åœ‹çš„æ”¿æ²»è®Šå‹•</option><option value="u_1768479449174_ght5l">ã€€â””â”€ æ˜¥ç§‹æˆ°åœ‹çš„ç¤¾æœƒè®Šå‹•</option><option value="u_1768479449174_jvdpc">ğŸ“‚ ç§¦æ¼¢ (ç›®éŒ„)</option><option value="u_1768479449174_mdm59">ã€€â””â”€ ç§¦å§‹çš‡çš„çµ±æ²»æ€æƒ³</option><option value="u_1768479449174_mvexj">ã€€â””â”€ ç§¦å§‹çš‡çš„çµ±æ²»æ”¿ç­–</option><option value="u_1768479449174_mzdgb">ã€€â””â”€ æ¼¢æ­¦å¸çš„çµ±æ²»æ€æƒ³</option><option value="u_1768479449174_v115d">ã€€â””â”€ æ¼¢æ­¦å¸çš„çµ±æ²»æ”¿ç­–</option><option value="u_1768479449174_la24y">ğŸ“‚ éš‹å” (ç›®éŒ„)</option><option value="u_1768479449174_r9vo5">ã€€â””â”€ é–‹çš‡ä¹‹æ²»</option><option value="u_1768479449174_pd40w">ã€€â””â”€ è²è§€ä¹‹æ²»</option><option value="u_1768479449174_3f9yh">ã€€â””â”€ é–‹å…ƒä¹‹æ²»</option><option value="u_1768479449174_hujez">ã€€â””â”€ å®‰å²ä¹‹äº‚</option><option value="u_1768479449174_l18d2">ğŸ“‚ å®‹å…ƒæ˜æ¸… (ç›®éŒ„)</option><option value="u_1768479449174_prib8">ã€€â””â”€ æ˜å¤ªç¥–çš„å›ä¸»é›†æ¬Š</option><option value="u_1768479449174_zgj24">ã€€â””â”€ æ˜æˆç¥–çš„å›ä¸»é›†æ¬Š</option><option value="u_1768479449174_p5r8r">ã€€â””â”€ æ˜ä»£å›ä¸»é›†æ¬Šçš„æˆæ•ˆèˆ‡æµå¼Š</option><option value="u_1768480267921_1ryh3">ğŸ“‚ ä¸­è¯äººæ°‘å…±å’Œåœ‹ (ç›®éŒ„)</option><option value="u_1768480267921_ljl5n">ã€€â””â”€ å»ºåœ‹åˆå¹´(1949-1952)</option><option value="u_1768480267921_4wm4b">ã€€â””â”€ ç¤¾æœƒä¸»ç¾©æ”¹é€ èˆ‡ä¸€äº”è¨ˆåŠƒ(1953-1957)</option><option value="u_1768480267921_8x6fs">ã€€â””â”€ å…¨é¢å»ºè¨­ç¤¾æœƒä¸»ç¾©èˆ‡ä¸‰é¢ç´…æ——(1958-1960)</option><option value="u_1768480267921_wt3ju">ã€€â””â”€ èª¿æ•´æ”¿ç­–(1961-1964)</option><option value="u_1768483861832">ã€€â””â”€ æ–‡åŒ–å¤§é©å‘½(1966-1976)</option><option value="u_1768483418939">ã€€â””â”€ æ”¹é©é–‹æ”¾(1978-)</option></select>
            </div>
            <textarea id="input-questions" class="input-area" placeholder="æ ¼å¼ç¯„ä¾‹ï¼š
å•é¡Œï¼šé¡Œç›®å…§å®¹...
Aï¼šé¸é …A
Bï¼šé¸é …B
Cï¼šé¸é …C
Dï¼šé¸é …D
æ­£ç¢ºç­”æ¡ˆï¼šA
è§£æï¼š...

(ç©ºè¡Œæ›ä¸‹ä¸€é¡Œ)"></textarea>
            <div class="action-bar">
                <button class="mode-btn primary" onclick="parseAndImport()">1. åŒ¯å…¥é¡Œç›®</button>
                <button class="mode-btn" style="border-color: var(--success); color: var(--success);" onclick="downloadUpdatedFile()">2. ä¸‹è¼‰æ›´æ–°æª”</button>
		<button class="menu-btn" style="background-color: #673ab7; color: white; margin-top: 5px;" onclick="openBatchQManager()">ğŸ“Š é¡Œç›®é †åº/åˆªé™¤ç®¡ç†</button>
            </div>
        </div>
    </div>

    <div class="card">
        <h3 style="color: var(--error); border-bottom: 2px solid var(--error); padding-bottom: 10px;">ğŸ—‘ï¸ ç®¡ç†é¡Œç›® (åˆªé™¤/ç·¨è¼¯)</h3>
        <div class="generator-container">
            <p style="font-size:14px; color:#666; margin:0;">é¸æ“‡å–®å…ƒä»¥ç®¡ç†é¡Œç›®ï¼š</p>
            <select id="delete-unit-select" class="mode-btn" style="padding:10px; margin:0;" onchange="loadQuestionsForDeletion()"><option value="">-- è«‹é¸æ“‡å–®å…ƒ --</option><option value="u_1768479449174_nr89z">ğŸ“‚ å¤å•†å‘¨ (ç›®éŒ„)</option><option value="u_1768479449174_lx1pi">ã€€â””â”€ å…©æ¬¡åˆ†å°</option><option value="u_1768479449174_q64k1">ã€€â””â”€ å°å»ºã€ç¦®æ¨‚ã€å®—æ³•åˆ¶åº¦</option><option value="u_1768479449174_riz5p">ã€€â””â”€ æ˜¥ç§‹æˆ°åœ‹çš„æ”¿æ²»è®Šå‹•</option><option value="u_1768479449174_ght5l">ã€€â””â”€ æ˜¥ç§‹æˆ°åœ‹çš„ç¤¾æœƒè®Šå‹•</option><option value="u_1768479449174_jvdpc">ğŸ“‚ ç§¦æ¼¢ (ç›®éŒ„)</option><option value="u_1768479449174_mdm59">ã€€â””â”€ ç§¦å§‹çš‡çš„çµ±æ²»æ€æƒ³</option><option value="u_1768479449174_mvexj">ã€€â””â”€ ç§¦å§‹çš‡çš„çµ±æ²»æ”¿ç­–</option><option value="u_1768479449174_mzdgb">ã€€â””â”€ æ¼¢æ­¦å¸çš„çµ±æ²»æ€æƒ³</option><option value="u_1768479449174_v115d">ã€€â””â”€ æ¼¢æ­¦å¸çš„çµ±æ²»æ”¿ç­–</option><option value="u_1768479449174_la24y">ğŸ“‚ éš‹å” (ç›®éŒ„)</option><option value="u_1768479449174_r9vo5">ã€€â””â”€ é–‹çš‡ä¹‹æ²»</option><option value="u_1768479449174_pd40w">ã€€â””â”€ è²è§€ä¹‹æ²»</option><option value="u_1768479449174_3f9yh">ã€€â””â”€ é–‹å…ƒä¹‹æ²»</option><option value="u_1768479449174_hujez">ã€€â””â”€ å®‰å²ä¹‹äº‚</option><option value="u_1768479449174_l18d2">ğŸ“‚ å®‹å…ƒæ˜æ¸… (ç›®éŒ„)</option><option value="u_1768479449174_prib8">ã€€â””â”€ æ˜å¤ªç¥–çš„å›ä¸»é›†æ¬Š</option><option value="u_1768479449174_zgj24">ã€€â””â”€ æ˜æˆç¥–çš„å›ä¸»é›†æ¬Š</option><option value="u_1768479449174_p5r8r">ã€€â””â”€ æ˜ä»£å›ä¸»é›†æ¬Šçš„æˆæ•ˆèˆ‡æµå¼Š</option><option value="u_1768480267921_1ryh3">ğŸ“‚ ä¸­è¯äººæ°‘å…±å’Œåœ‹ (ç›®éŒ„)</option><option value="u_1768480267921_ljl5n">ã€€â””â”€ å»ºåœ‹åˆå¹´(1949-1952)</option><option value="u_1768480267921_4wm4b">ã€€â””â”€ ç¤¾æœƒä¸»ç¾©æ”¹é€ èˆ‡ä¸€äº”è¨ˆåŠƒ(1953-1957)</option><option value="u_1768480267921_8x6fs">ã€€â””â”€ å…¨é¢å»ºè¨­ç¤¾æœƒä¸»ç¾©èˆ‡ä¸‰é¢ç´…æ——(1958-1960)</option><option value="u_1768480267921_wt3ju">ã€€â””â”€ èª¿æ•´æ”¿ç­–(1961-1964)</option><option value="u_1768483861832">ã€€â””â”€ æ–‡åŒ–å¤§é©å‘½(1966-1976)</option><option value="u_1768483418939">ã€€â””â”€ æ”¹é©é–‹æ”¾(1978-)</option></select>
            <div id="delete-list-container" style="max-height: 400px; overflow-y: auto; border: 1px solid rgb(238, 238, 238); border-radius: 8px; background: rgb(250, 250, 250); display: none;"><div style="padding:10px;text-align:center;">æ­¤å–®å…ƒ(æˆ–ç›®éŒ„)ç„¡é¡Œç›®</div></div>
        </div>
    </div>
</div>

<script>
    // --- è³‡æ–™çµæ§‹ (Database) ---
    // [é‡è¦] è«‹ç¢ºä¿ä»¥ä¸‹å…©å€‹æ¨™è¨˜ (QUIZDB START/END) å­˜åœ¨
    // --- QUIZDB START ---
    const quizDB = {
    "part_1768479449174_j0foo": {
        "title": "ç”²éƒ¨",
        "units": [
            {
                "id": "u_1768479449174_nr89z",
                "name": "å¤å•†å‘¨",
                "questions": [],
                "subUnits": [
                    {
                        "id": "u_1768479449174_lx1pi",
                        "name": "å…©æ¬¡åˆ†å°",
                        "questions": []
                    },
                    {
                        "id": "u_1768479449174_q64k1",
                        "name": "å°å»ºã€ç¦®æ¨‚ã€å®—æ³•åˆ¶åº¦",
                        "questions": []
                    },
                    {
                        "id": "u_1768479449174_riz5p",
                        "name": "æ˜¥ç§‹æˆ°åœ‹çš„æ”¿æ²»è®Šå‹•",
                        "questions": []
                    },
                    {
                        "id": "u_1768479449174_ght5l",
                        "name": "æ˜¥ç§‹æˆ°åœ‹çš„ç¤¾æœƒè®Šå‹•",
                        "questions": []
                    }
                ]
            },
            {
                "id": "u_1768479449174_jvdpc",
                "name": "ç§¦æ¼¢",
                "questions": [],
                "subUnits": [
                    {
                        "id": "u_1768479449174_mdm59",
                        "name": "ç§¦å§‹çš‡çš„çµ±æ²»æ€æƒ³",
                        "questions": []
                    },
                    {
                        "id": "u_1768479449174_mvexj",
                        "name": "ç§¦å§‹çš‡çš„çµ±æ²»æ”¿ç­–",
                        "questions": []
                    },
                    {
                        "id": "u_1768479449174_mzdgb",
                        "name": "æ¼¢æ­¦å¸çš„çµ±æ²»æ€æƒ³",
                        "questions": []
                    },
                    {
                        "id": "u_1768479449174_v115d",
                        "name": "æ¼¢æ­¦å¸çš„çµ±æ²»æ”¿ç­–",
                        "questions": []
                    }
                ]
            },
            {
                "id": "u_1768479449174_la24y",
                "name": "éš‹å”",
                "questions": [],
                "subUnits": [
                    {
                        "id": "u_1768479449174_r9vo5",
                        "name": "é–‹çš‡ä¹‹æ²»",
                        "questions": []
                    },
                    {
                        "id": "u_1768479449174_pd40w",
                        "name": "è²è§€ä¹‹æ²»",
                        "questions": []
                    },
                    {
                        "id": "u_1768479449174_3f9yh",
                        "name": "é–‹å…ƒä¹‹æ²»",
                        "questions": []
                    },
                    {
                        "id": "u_1768479449174_hujez",
                        "name": "å®‰å²ä¹‹äº‚",
                        "questions": []
                    }
                ]
            },
            {
                "id": "u_1768479449174_l18d2",
                "name": "å®‹å…ƒæ˜æ¸…",
                "questions": [],
                "subUnits": [
                    {
                        "id": "u_1768479449174_prib8",
                        "name": "æ˜å¤ªç¥–çš„å›ä¸»é›†æ¬Š",
                        "questions": []
                    },
                    {
                        "id": "u_1768479449174_zgj24",
                        "name": "æ˜æˆç¥–çš„å›ä¸»é›†æ¬Š",
                        "questions": []
                    },
                    {
                        "id": "u_1768479449174_p5r8r",
                        "name": "æ˜ä»£å›ä¸»é›†æ¬Šçš„æˆæ•ˆèˆ‡æµå¼Š",
                        "questions": []
                    }
                ]
            }
        ]
    },
    "part_1768480267921_9igzt": {
        "title": "ä¹™éƒ¨",
        "units": [
            {
                "id": "u_1768480267921_1ryh3",
                "name": "ä¸­è¯äººæ°‘å…±å’Œåœ‹",
                "questions": [],
                "subUnits": [
                    {
                        "id": "u_1768480267921_ljl5n",
                        "name": "å»ºåœ‹åˆå¹´(1949-1952)",
                        "questions": []
                    },
                    {
                        "id": "u_1768480267921_4wm4b",
                        "name": "ç¤¾æœƒä¸»ç¾©æ”¹é€ èˆ‡ä¸€äº”è¨ˆåŠƒ(1953-1957)",
                        "questions": []
                    },
                    {
                        "id": "u_1768480267921_8x6fs",
                        "name": "å…¨é¢å»ºè¨­ç¤¾æœƒä¸»ç¾©èˆ‡ä¸‰é¢ç´…æ——(1958-1960)",
                        "questions": []
                    },
                    {
                        "id": "u_1768480267921_wt3ju",
                        "name": "èª¿æ•´æ”¿ç­–(1961-1964)",
                        "questions": []
                    },
                    {
                        "id": "u_1768483861832",
                        "name": "æ–‡åŒ–å¤§é©å‘½(1966-1976)",
                        "questions": [
                            {
                                "q": "é—œæ–¼ã€Œå››äººå¹«ã€çš„çµ„æˆæˆå“¡ï¼Œä¸‹åˆ—å“ªä¸€ä½ä¸å±¬æ–¼å…¶ä¸­ï¼Ÿ",
                                "options": [
                                    "A. æ±Ÿé’",
                                    "B. å¼µæ˜¥æ©‹",
                                    "C. è¯åœ‹é‹’",
                                    "D. ç‹æ´ªæ–‡"
                                ],
                                "ans": 3,
                                "exp": "ã€Œå››äººå¹«ã€åŒ…æ‹¬æ±Ÿé’ã€å¼µæ˜¥æ©‹ã€ç‹æ´ªæ–‡ã€å§šæ–‡å…ƒã€‚è¯åœ‹é‹’æ˜¯æ¯›æ¾¤æ±é€ä¸–å¾Œçš„æ¥ç­äººï¼Œä¸¦é ˜å°äº†é€®æ•å››äººå¹«çš„è¡Œå‹•ã€‚"
                            }
                        ]
                    },
                    {
                        "id": "u_1768483418939",
                        "name": "æ”¹é©é–‹æ”¾(1978-)",
                        "questions": []
                    }
                ]
            }
        ]
    }
};
    // --- QUIZDB END ---

    // --- æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹ ---
    let currentQuestions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let userAnswers = [];
    let currentUnitId = null;
    let pendingUnitId = null; 
    let pendingUnitName = null;
    
    // ç¶œåˆæ¸¬é©—æš«å­˜
    let pendingMixedUnit = null; 
    
    // ç·¨è¼¯é¡Œç›®æš«å­˜
    let currentEditUnitId = null;
    let currentEditIndex = null;

    // --- åˆå§‹åŒ– ---
    window.onload = function() {
    // 1. è¼‰å…¥è³‡æ–™ (é€™è¡Œä¿ç•™)
    if(typeof loadData === 'function') loadData();
    
    // 2. åˆå§‹åŒ–é¸å–® (é€™è¡Œä¿ç•™)
    if(typeof initMenu === 'function') initMenu();
    
    // 3. â˜… è¨­å®šé¦–é ï¼šæ”¹æˆé¡¯ç¤ºæ­¡è¿é 
    showView('view-welcome');
};

    function initMenu() {
        const quizMenu = document.getElementById('menu-quiz');
        const ansMenu = document.getElementById('menu-ans');
        let htmlQuiz = '';
        let htmlAns = '';

        for (const key in quizDB) {
            const part = quizDB[key];
            htmlQuiz += `<div class="nav-part-header">${part.title}</div>`;
            htmlAns += `<div class="nav-part-header">${part.title}</div>`;

            part.units.forEach(unit => {
                if (unit.subUnits) {
                    htmlQuiz += `
                        <div class="unit-group-title">
                            <div class="unit-click-area" onclick="toggleUnitSubmenu(this)">
                                <span>${unit.name}</span>
                                <span class="arrow">â–¼</span>
                            </div>
                            <button class="mixed-quiz-btn" onclick="openMixedModeModal('${unit.id}', '${unit.name}')">ğŸš€ ç¶œåˆ</button>
                        </div>
                        <div class="unit-submenu">
                            ${unit.subUnits.map(sub => `<div class="unit-sub-item" onclick="openModeModal('${sub.id}', '${sub.name}')">${sub.name}</div>`).join('')}
                        </div>`;
                    
                    htmlAns += `
                        <div class="unit-group-title">
                            <div class="unit-click-area" onclick="toggleUnitSubmenu(this)">
                                <span>${unit.name}</span>
                                <span class="arrow">â–¼</span>
                            </div>
                        </div>
                        <div class="unit-submenu">
                            ${unit.subUnits.map(sub => `<div class="unit-sub-item" onclick="showAnswers('${sub.id}')">${sub.name}</div>`).join('')}
                        </div>`;
                } else {
                    htmlQuiz += `<div class="nav-item" onclick="openModeModal('${unit.id}', '${unit.name}')">${unit.name}</div>`;
                    htmlAns += `<div class="nav-item" onclick="showAnswers('${unit.id}')">${unit.name}</div>`;
                }
            });
        }
        quizMenu.innerHTML = htmlQuiz;
        ansMenu.innerHTML = htmlAns;
    }

    // --- å´é‚Šæ¬„æ§åˆ¶ ---
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.querySelector('.sidebar-overlay');
        const isOpen = sidebar.classList.contains('open');

        if (isOpen) {
            // ---åŸæœ¬çš„é—œé–‰é‚è¼¯---
            sidebar.classList.remove('open');
            overlay.style.opacity = '0';
            setTimeout(() => overlay.style.display = 'none', 300);
        } else {
            // ---åŸæœ¬çš„é–‹å•Ÿé‚è¼¯---
            
            // â˜…â˜…â˜… æ–°å¢ï¼šåœ¨æ‰“é–‹ä¹‹å‰ï¼Œå…ˆå¼·åˆ¶æ”¶èµ·æ‰€æœ‰å·²å±•é–‹çš„å­é¸å–® â˜…â˜…â˜…
            
            // 1. æ‰¾å‡ºå´é‚Šæ¬„å…§æ‰€æœ‰ã€Œè¢«è½‰å‹•éã€çš„ç®­é ­ï¼ŒæŠŠå®ƒå€‘è½‰å›ä¾†
            const allArrows = sidebar.querySelectorAll('.arrow');
            allArrows.forEach(arrow => arrow.classList.remove('rotate'));

            // 2. æ‰¾å‡ºå´é‚Šæ¬„å…§æ‰€æœ‰ã€Œé¡¯ç¤ºä¸­ (display: block)ã€çš„å€å¡Šï¼ŒæŠŠå®ƒå€‘è—èµ·ä¾†
            // ç‚ºäº†é¿å…èª¤å‚·å…¶ä»–å…ƒç´ ï¼Œæˆ‘å€‘åªé‡å°æœ‰ id æˆ–ç‰¹å®šçµæ§‹çš„ div
            const allDivs = sidebar.querySelectorAll('div');
            allDivs.forEach(div => {
                // å¦‚æœé€™å€‹ div æ˜¯é€é JS è¢«è¨­ç‚ºé¡¯ç¤ºçš„ (block)ï¼Œå°±æŠŠå®ƒé—œæ‰
                if (div.style.display === 'block') {
                    div.style.display = 'none';
                }
            });
            // â˜…â˜…â˜… æ–°å¢çµæŸ â˜…â˜…â˜…

            overlay.style.display = 'block';
            setTimeout(() => overlay.style.opacity = '1', 10);
            sidebar.classList.add('open');
        }
    }

    function toggleSubmenu(id, titleEl) {
        const submenu = document.getElementById(id);
        const arrow = titleEl.querySelector('.arrow');
        // é€™è£¡ä¸éœ€è¦æ”¹å‹•ï¼Œä¿æŒåŸæ¨£
        if (submenu.style.display === 'block') { 
            submenu.style.display = 'none'; 
            arrow.classList.remove('rotate'); 
        } else { 
            submenu.style.display = 'block'; 
            arrow.classList.add('rotate'); 
        }
    }
    
    function toggleUnitSubmenu(clickArea) {
        const parent = clickArea.parentElement;
        const submenu = parent.nextElementSibling;
        const arrow = clickArea.querySelector('.arrow');
        // é€™è£¡ä¸éœ€è¦æ”¹å‹•ï¼Œä¿æŒåŸæ¨£
        if (submenu.style.display === 'block') { 
            submenu.style.display = 'none'; 
            arrow.classList.remove('rotate'); 
        } else { 
            submenu.style.display = 'block'; 
            arrow.classList.add('rotate'); 
        }
    }

    // --- æ¸¬é©—é‚è¼¯ ---
    function openModeModal(unitId, unitName) {
        pendingUnitId = unitId; pendingUnitName = unitName;
        document.getElementById('modal-title').innerText = unitName;
        document.getElementById('mode-modal').style.display = 'flex';
        toggleSidebar(); 
    }
    
    function openMixedModeModal(unitId, unitName) {
        pendingUnitId = unitId; 
        pendingUnitName = unitName;
        let unitData = findUnitById(unitId);
        if (!unitData || !unitData.subUnits) return;
        pendingMixedUnit = unitData;
        document.getElementById('mixed-modal-title').innerText = `ğŸš€ ${unitName} - ç¶œåˆæ¸¬é©—`;
        const container = document.getElementById('mixed-checkbox-container');
        container.innerHTML = '';
        unitData.subUnits.forEach(sub => {
            const qCount = sub.questions ? sub.questions.length : 0;
            const div = document.createElement('div');
            div.className = 'checkbox-item';
            div.innerHTML = `
                <label style="flex:1; cursor:pointer; display:flex; align-items:center;">
                    <input type="checkbox" value="${sub.id}" checked onchange="updateMixedTotalCount()">
                    ${sub.name} <span style="font-size:12px; color:#888; margin-left:5px;">(${qCount}é¡Œ)</span>
                </label>`;
            container.appendChild(div);
        });
        document.getElementById('mixed-modal').style.display = 'flex';
        toggleSidebar();
        updateMixedTotalCount();
    }
    
    function updateMixedTotalCount() {
        const checkboxes = document.querySelectorAll('#mixed-checkbox-container input[type="checkbox"]:checked');
        let total = 0;
        checkboxes.forEach(cb => {
            const sub = pendingMixedUnit.subUnits.find(s => s.id === cb.value);
            if (sub && sub.questions) total += sub.questions.length;
        });
        document.getElementById('mixed-max-count').innerText = `å…± ${total} é¡Œå¯ç”¨`;
        document.getElementById('mixed-q-count').max = total;
    }
    
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    
    function startQuiz(mode) {
        closeModal('mode-modal'); currentUnitId = pendingUnitId;
        let unitData = findUnitById(pendingUnitId); if (!unitData) return;
        let qList = JSON.parse(JSON.stringify(unitData.questions));
        if (mode === 'random') qList = shuffleArray(qList);
        currentQuestions = qList; currentQuestionIndex = 0; userAnswers = []; score = 0;
        showView('view-quiz'); document.getElementById('quiz-unit-name').innerText = unitData.name; renderQuestion();
    }
    
    function startMixedQuiz() {
        const checkboxes = document.querySelectorAll('#mixed-checkbox-container input[type="checkbox"]:checked');
        if (checkboxes.length === 0) { alert("è«‹è‡³å°‘é¸æ“‡ä¸€å€‹å­å–®å…ƒï¼"); return; }
        let pool = [];
        checkboxes.forEach(cb => {
            const sub = pendingMixedUnit.subUnits.find(s => s.id === cb.value);
            if (sub && sub.questions) { pool = pool.concat(JSON.parse(JSON.stringify(sub.questions))); }
        });
        if (pool.length === 0) { alert("æ‰€é¸å–®å…ƒæ²’æœ‰é¡Œç›®ï¼"); return; }
        let reqCount = parseInt(document.getElementById('mixed-q-count').value);
        if (isNaN(reqCount) || reqCount < 1) reqCount = 10;
        pool = shuffleArray(pool);
        if (reqCount < pool.length) { currentQuestions = pool.slice(0, reqCount); } else { currentQuestions = pool; }
        closeModal('mixed-modal');
        currentUnitId = pendingUnitId; 
        const finalTitle = `${pendingUnitName} (ç¶œåˆæ¸¬é©— - ${currentQuestions.length}é¡Œ)`;
        currentQuestionIndex = 0; userAnswers = []; score = 0;
        showView('view-quiz');
        document.getElementById('quiz-unit-name').innerText = finalTitle;
        pendingUnitName = finalTitle; 
        renderQuestion();
    }
    
    function startRetry(historyIndex) {
        const h = JSON.parse(localStorage.getItem('quizHistory') || '[]');
        const record = h[historyIndex];
        if (!record || !record.wrongIndices || record.wrongIndices.length === 0) { alert("ç„¡éŒ¯é¡Œè³‡æ–™"); return; }
        currentQuestions = JSON.parse(JSON.stringify(record.wrongIndices)); 
        pendingUnitName = `${record.unitName} (éŒ¯é¡Œè¤‡ç¿’)`;
        currentUnitId = record.unitId;
        currentQuestionIndex = 0; userAnswers = []; score = 0;
        showView('view-quiz');
        document.getElementById('quiz-unit-name').innerText = pendingUnitName;
        renderQuestion();
    }
    
    function findUnitById(id) {
        for (const key in quizDB) {
            const units = quizDB[key].units;
            for (let i = 0; i < units.length; i++) {
                if (units[i].id === id) return units[i];
                if (units[i].subUnits) { const sub = units[i].subUnits.find(u => u.id === id); if (sub) return sub; }
            }
        } return null;
    }
    function shuffleArray(arr) { for (let i = arr.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [arr[i], arr[j]] = [arr[j], arr[i]]; } return arr; }
    function renderQuestion() {
        const container = document.getElementById('quiz-container'); const q = currentQuestions[currentQuestionIndex];
        document.getElementById('quiz-counter').innerText = `${currentQuestionIndex + 1} / ${currentQuestions.length}`;
        document.getElementById('next-btn').style.display = 'none';
        let html = `<div class="question-text">${q.q}</div>`;
        q.options.forEach((opt, idx) => { html += `<button class="option-btn" onclick="checkAnswer(this, ${idx + 1})">${opt}</button>`; });
        html += `<div id="exp-block" class="explanation"><strong>è§£æï¼š</strong><br>${q.exp || "ç„¡è§£æ"}</div>`;
        container.innerHTML = html;
    }
    function checkAnswer(btn, selectedIdx) {
        const q = currentQuestions[currentQuestionIndex]; const btns = document.querySelectorAll('.option-btn');
        btns.forEach(b => b.classList.add('disabled'));
        let isCorrect = (selectedIdx === q.ans);
        if (isCorrect) { btn.classList.add('correct'); score++; } else { btn.classList.add('wrong'); btns[q.ans - 1].classList.add('correct'); }
        userAnswers.push({ qIndex: currentQuestionIndex, question: q, isCorrect: isCorrect, userChoice: selectedIdx });
        document.getElementById('exp-block').style.display = 'block';
        const next = document.getElementById('next-btn'); next.style.display = 'block';
        setTimeout(() => next.scrollIntoView({ behavior: 'smooth' }), 100);
    }
    function nextQuestion() { currentQuestionIndex++; if (currentQuestionIndex < currentQuestions.length) renderQuestion(); else finishQuiz(); }
    // â˜…â˜…â˜… (æœ€æ–°ç‰ˆ) æ¸¬é©—çµæŸå‡½å¼ï¼šåŠ å…¥é¡Œè™Ÿè¨˜éŒ„åŠŸèƒ½ â˜…â˜…â˜…
function finishQuiz() {
    // 1. è¨ˆç®—åˆ†æ•¸
    const total = currentQuestions.length;
    const finalScore = total > 0 ? Math.round((score / total) * 100) : 0;

    // 2. æ”¶é›†éŒ¯é¡Œ
    const wrongIndices = [];
    userAnswers.forEach((ans, idx) => {
        if (!ans.isCorrect) wrongIndices.push(idx);
    });

    // 3. ã€é—œéµä¿®æ­£ã€‘æ­£ç¢ºè¨˜éŒ„å·²å®Œæˆçš„é¡Œç›®
    // æˆ‘å€‘å„ªå…ˆè¨˜éŒ„ IDï¼Œå¦‚æœæ²’æœ‰ IDï¼Œå°±è¨˜éŒ„ã€Œé¡Œç›®å…§å®¹ (q.q)ã€
    const doneQuestionIds = currentQuestions.map(q => {
        // å¼·åˆ¶è½‰æˆå­—ä¸²ï¼Œé¿å…æ•¸å­—/æ–‡å­—ä¸ç¬¦çš„å•é¡Œ
        if (q.id) return String(q.id);
        if (q.q) return String(q.q); 
        return "unknown_" + Math.random(); // è¬ä¸€çœŸçš„ä»€éº¼éƒ½æ²’æœ‰
    });

    // 4. å»ºç«‹ä¸¦å„²å­˜è¨˜éŒ„
    const record = {
        unitName: pendingUnitName || "æ¸¬é©—",
        date: new Date().toLocaleString(),
        score: finalScore,
        wrongIndices: wrongIndices,
        questionIds: doneQuestionIds, // é€™è£¡å­˜é€²å»æ­£ç¢ºçš„è³‡æ–™äº†
        totalQuestions: total
    };

    try {
        const history = JSON.parse(localStorage.getItem('quizHistory') || '[]');
        history.unshift(record);
        localStorage.setItem('quizHistory', JSON.stringify(history));
    } catch (e) {
        console.error("å­˜æª”å¤±æ•—", e);
        alert("å­˜æª”ç©ºé–“ä¸è¶³ï¼Œè¨˜éŒ„å¯èƒ½æœªå®Œæ•´å„²å­˜");
    }

    // 5. çµæŸæç¤º
    alert(`æ¸¬é©—çµæŸï¼\næ‚¨çš„å¾—åˆ†æ˜¯ï¼š${finalScore} åˆ†`);
    
    // è¿”å›è¨˜éŒ„é æˆ–é¦–é 
    if (typeof showHistoryView === 'function') {
        showHistoryView(); 
    } else {
        location.reload(); 
    }
}
    function showAnswers(unitId) {
    const unit = findUnitById(unitId);
    if (!unit) return;

    showView('view-answers');
    toggleSidebar(); 
    document.getElementById('ans-unit-title').innerText = `${unit.name} - å®Œæ•´è§£æ`;
    
    const list = document.getElementById('ans-list');
    list.innerHTML = ''; 

    // --- è®€å–æ­·å²è¨˜éŒ„ ---
    const history = JSON.parse(localStorage.getItem('quizHistory') || '[]');
    const doneSet = new Set();
    history.forEach(rec => {
        if (rec.questionIds && Array.isArray(rec.questionIds)) {
            rec.questionIds.forEach(id => {
                // é€™è£¡ä¹Ÿå¼·åˆ¶è½‰æˆå­—ä¸²ï¼Œè·Ÿä¸Šé¢ finishQuiz ä¿æŒä¸€è‡´
                if(id) doneSet.add(String(id)); 
            });
        }
    });

    let html = '';
    
    unit.questions.forEach((q, idx) => {
        // --- â˜…â˜…â˜… æ ¸å¿ƒæ¯”å° (å…¨éƒ¨è½‰å­—ä¸²) â˜…â˜…â˜… ---
        // é€™æ¨£å°±ç®—ä¸€å€‹æ˜¯æ•¸å­— 1ï¼Œä¸€å€‹æ˜¯å­—ä¸² "1"ï¼Œä¹Ÿèƒ½é…å°æˆåŠŸ
        const qId = q.id ? String(q.id) : null;
        const qText = q.q ? String(q.q) : null;
        
        const isDone = (qId && doneSet.has(qId)) || (qText && doneSet.has(qText));

        if (isDone) {
            // âœ… åšéäº†ï¼šé¡¯ç¤ºç­”æ¡ˆ (æ‚¨çš„åŸæœ¬æ¨£å¼)
            const ansLetter = ['A','B','C','D'][q.ans - 1];
            let optionsHtml = '<div style="margin: 10px 0 15px 15px;">';
            q.options.forEach((opt, i) => {
                const isCorrect = (i + 1) === q.ans;
                const style = isCorrect ? 'color:#2e7d32; font-weight:bold;' : 'color:#666;';
                optionsHtml += `<div style="${style}; margin-bottom:4px;">${opt}</div>`;
            });
            optionsHtml += '</div>';

            html += `
                <div class="ans-item">
                    <div style="font-weight:bold; margin-bottom:5px; font-size:16px;">
                        <span style="color:var(--primary);">${idx + 1}.</span> ${q.q}
                    </div>
                    ${optionsHtml}
                    <div style="color:var(--success); font-weight:bold; margin-bottom:5px;">
                        âœ… æ­£ç¢ºç­”æ¡ˆï¼š${ansLetter}
                    </div>
                    <div style="font-size:14px; color:#444; background:#f0f4c3; padding:12px; border-radius:8px; line-height:1.5;">
                        ğŸ’¡ <strong>è§£æï¼š</strong><br>${q.exp || "æš«ç„¡è§£æ"}
                    </div>
                </div>`;
        } else {
            // ğŸ”’ æ²’åšéï¼šé¡¯ç¤ºé–é ­
            html += `
                <div class="ans-item" style="background:#f9f9f9; border:1px dashed #ccc; opacity:0.8; text-align:center; padding:30px;">
                    <div style="font-weight:bold; margin-bottom:10px; color:#777;">
                        <span>${idx + 1}.</span> ${q.q}
                    </div>
                    <div style="font-size:2em;">ğŸ”’</div>
                    <div style="color:#666; margin-top:5px;">ç­”æ¡ˆå·²éš±è—ï¼Œè«‹å…ˆå®Œæˆæ¸¬é©—</div>
                </div>`;
        }
    });
    list.innerHTML = html;
}
    function loadHistory() {}
    
    function showHistoryView() {
    console.log("é€²å…¥æ­·å²è¨˜éŒ„é é¢");

    // --- 1. æŒ–æ˜é¡Œç›® ---
    let allQuestions = [];
    if (typeof quizDB !== 'undefined') {
        Object.values(quizDB).forEach(part => {
            if (part.units) {
                part.units.forEach(unit => {
                    if (unit.subUnits) unit.subUnits.forEach(s => { if(s.questions) allQuestions = allQuestions.concat(s.questions); });
                    if (unit.questions) allQuestions = allQuestions.concat(unit.questions);
                });
            }
        });
    }

    // --- 2. è¨ˆç®—é€²åº¦ ---
    const history = JSON.parse(localStorage.getItem('quizHistory') || '[]');
    const doneSet = new Set();
    history.forEach(rec => {
        if (rec.questionIds) rec.questionIds.forEach(id => { if(id) doneSet.add(id); });
    });

    // æ™ºæ…§è£œæ•‘ (é˜²æ­¢é‡æ•´å¾Œåˆ†æ¯è®Šå°)
    let doneCount = doneSet.size;
    let totalCount = allQuestions.length;
    if (doneCount > totalCount) totalCount = doneCount;
    const displayTotal = totalCount > 0 ? totalCount : 1;
    const percent = Math.round((doneCount / displayTotal) * 100);

    // --- 3. ç¹ªè£½ç•«é¢ ---
    const list = document.getElementById('history-list');
    if (!list) return;
    list.innerHTML = ''; 

    // â˜…â˜…â˜… æ–°å¢ï¼šé ‚éƒ¨å°èˆªåˆ— (æ•‘ç”Ÿåœˆ) â˜…â˜…â˜…
    const navHeader = `
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <button onclick="location.reload()" style="background:#f5f5f5; border:1px solid #ddd; padding:8px 15px; border-radius:20px; cursor:pointer; font-weight:bold; color:#555;">
                â¬…ï¸ è¿”å›é¦–é 
            </button>
            <span style="font-size:0.9em; color:#999;">çµ±è¨ˆæ™‚é–“: ${new Date().toLocaleTimeString()}</span>
        </div>
    `;
    list.insertAdjacentHTML('beforeend', navHeader);

    // é€²åº¦æ¢
    const dashboard = `
        <div style="background:white; padding:15px; border-radius:12px; box-shadow:0 2px 5px rgba(0,0,0,0.05); margin-bottom:20px;">
            <h3 style="margin:0 0 10px 0; color:#333; font-size:1.1em;">ğŸ“Š ç¸½ç·´ç¿’é€²åº¦</h3>
            <div style="display:flex; justify-content:space-between; font-size:0.9em; color:#555; margin-bottom:5px;">
                <span>å·²å®Œæˆ</span>
                <span style="font-weight:bold; color:${percent > 0 ? '#2196f3' : '#999'}">${doneCount} / ${totalCount} (${percent}%)</span>
            </div>
            <div style="background:#eee; height:12px; border-radius:6px; overflow:hidden;">
                <div style="background:#2196f3; width:${percent}%; height:100%; transition: width 0.5s;"></div>
            </div>
        </div>
    `;
    list.insertAdjacentHTML('beforeend', dashboard);

    // æ­·å²åˆ—è¡¨
    if (history.length === 0) {
        list.innerHTML += '<div style="text-align:center; color:#999; padding:30px;">å°šç„¡è¨˜éŒ„</div>';
    } else {
        history.forEach((rec, index) => {
            const item = document.createElement('div');
            const color = rec.score >= 60 ? '#4caf50' : '#f44336';
            item.style.cssText = `background:white; padding:15px; border-radius:8px; margin-bottom:10px; border-left: 5px solid ${color}; box-shadow: 0 1px 3px rgba(0,0,0,0.1);`;
            
            item.innerHTML = `
                <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                    <strong style="font-size:1.1em;">${rec.unitName || rec.date}</strong>
                    <span style="color:${color}; font-weight:bold;">${rec.score}åˆ†</span>
                </div>
                <div style="font-size:0.85em; color:#666;">
                    <span>ğŸ“… ${rec.date}</span>
                    <span style="margin-left:10px;">å…± ${rec.totalQuestions || 0} é¡Œ</span>
                </div>
            `;
            if(rec.wrongIndices && rec.wrongIndices.length > 0) {
                const btn = document.createElement('button');
                btn.innerText = `é‡åšéŒ¯é¡Œ (${rec.wrongIndices.length})`;
                btn.style.cssText = "margin-top:8px; padding:6px 12px; background:#fff3e0; color:#e65100; border:none; border-radius:4px; font-size:0.9em; cursor:pointer;";
                btn.onclick = function() { if (typeof retryWrong === 'function') retryWrong(index); };
                item.appendChild(btn);
            }
            list.appendChild(item);
        });
    }

    // å‘¼å«æ–°çš„å®‰å…¨åˆ‡æ›å‡½å¼
    if (typeof showView === 'function') {
        showView('view-history');
    } else {
        // å‚™ç”¨æ–¹æ¡ˆ
        document.querySelectorAll('.view, .view-section').forEach(v => v.style.display = 'none');
        document.getElementById('view-history').style.display = 'block';
    }
}
    
    function renderHistoryList() {
        const list = document.getElementById('history-list'); 
        const h = JSON.parse(localStorage.getItem('quizHistory') || '[]');
        if (h.length === 0) { list.innerHTML = '<div style="text-align:center;color:#999;margin-top:50px;">ç„¡è¨˜éŒ„</div>'; return; }
        
        let html = ''; 
        h.forEach((r, idx) => { 
            const isFull = r.score === 100;
            const statusClass = isFull ? 'done' : 'has-wrong';
            html += `<div class="card history-card ${statusClass}">
                        <div class="score-badge">${r.score}%</div>
                        <div style="font-weight:bold;">${r.unitName}</div>
                        <div class="history-meta">${r.date}</div>`;
            if (!isFull) {
                const wrongCount = r.wrongIndices ? r.wrongIndices.length : 0;
                html += `<div style="margin-top:10px; font-size:13px; color:#c62828;">
                            éŒ¯é¡Œï¼š${wrongCount} é¡Œ
                         </div>
                         <button class="retry-btn" onclick="startRetry(${idx})">é‡åšéŒ¯é¡Œ</button>`;
            } else {
                html += `<div style="margin-top:10px; font-size:13px; color:var(--success);">å®Œç¾é€šé—œï¼</div>`;
            }
            html += `</div>`;
        }); 
        list.innerHTML = html;
    }
    function clearHistory() { if(confirm("æ¸…é™¤æ‰€æœ‰è¨˜éŒ„ï¼Ÿ")) { localStorage.removeItem('quizHistory'); renderHistoryList(); } }

    function showView(viewId) {
    // 1. å¼·åˆ¶è§£é–æ‰€æœ‰é é¢ (æ¸…é™¤ inline styles)
    const allViews = document.querySelectorAll('.view, .view-section, div[id^="view-"]');
    allViews.forEach(el => {
        el.style.display = 'none'; // å…ˆå…¨éƒ¨è—èµ·ä¾†
        el.classList.remove('active'); // ç§»é™¤å¯èƒ½çš„ active ç‹€æ…‹
    });

    // 2. é¡¯ç¤ºç›®æ¨™é é¢
    const target = document.getElementById(viewId);
    if (target) {
        target.style.display = 'block'; // å¼·åˆ¶é¡¯ç¤ºç›®æ¨™
        window.scrollTo(0, 0); // æ²å‹•åˆ°æœ€ä¸Šæ–¹
    }

    // 3. æ›´æ–° Sidebar/é¸å–®ç‹€æ…‹ (å¦‚æœæœ‰é¸å–®çš„è©±)
    document.querySelectorAll('.sidebar-item, .nav-item').forEach(item => {
        item.classList.remove('active');
        // å˜—è©¦æ ¹æ“šé»æ“Šäº‹ä»¶åŒ¹é…
        const onclickAttr = item.getAttribute('onclick');
        if (onclickAttr && onclickAttr.includes(viewId)) {
            item.classList.add('active');
        }
    });
}

    // --- å‡ºé¡Œèˆ‡ç®¡ç†ç³»çµ± ---

    function showGeneratorView() {
        showView('view-generator'); toggleSidebar(); refreshAllMenus();
    }

    function refreshAllMenus() {
        populateAddUnitParentSelect();
        populateUnitSelect(document.getElementById('delete-unit-select'));
        populateUnitSelect(document.getElementById('import-target-unit'));
        updateStructureScopeSelect();
    }

    // 0. æ‰¹æ¬¡å»ºç«‹çµæ§‹
    function batchCreateStructure() {
        const text = document.getElementById('batch-structure-input').value;
        const lines = text.split('\n');
        
        let lastPartKey = null;
        let lastUnit = null; 
        
        let countParts = 0; let countUnits = 0; let countSubs = 0;

        lines.forEach(line => {
            const trimmedLine = line.trimEnd(); 
            if(!trimmedLine.trim()) return; 

            if (trimmedLine.startsWith('----')) {
                if (!lastUnit) return; 
                const name = trimmedLine.substring(4).trim();
                if(!name) return;
                if (!lastUnit.subUnits) { lastUnit.subUnits = []; }
                lastUnit.subUnits.push({ id: `u_${Date.now()}_${Math.random().toString(36).substr(2,5)}`, name: name, questions: [] });
                countSubs++;
            } else if (trimmedLine.startsWith('--')) {
                if (!lastPartKey) return; 
                const name = trimmedLine.substring(2).trim();
                if(!name) return;
                const newUnit = { id: `u_${Date.now()}_${Math.random().toString(36).substr(2,5)}`, name: name, questions: [] };
                quizDB[lastPartKey].units.push(newUnit);
                lastUnit = newUnit; countUnits++;
            } else {
                const name = trimmedLine.trim();
                if(!name) return;
                const newKey = `part_${Date.now()}_${Math.random().toString(36).substr(2,5)}`;
                quizDB[newKey] = { title: name, units: [] };
                lastPartKey = newKey; lastUnit = null; countParts++;
            }
        });

        if (countParts + countUnits + countSubs > 0) {
            document.getElementById('batch-structure-input').value = "";
            initMenu(); refreshAllMenus();
            alert(`æ‰¹æ¬¡å»ºç«‹æˆåŠŸï¼\næ–°å¢äº†ï¼š\n${countParts} å€‹éƒ¨\n${countUnits} å€‹å–®å…ƒ\n${countSubs} å€‹å­å–®å…ƒ\n\nåˆ¥å¿˜äº†ä¸‹è¼‰æ›´æ–°æª”ä¿å­˜ï¼`);
        } else {
            alert("æœªå»ºç«‹ä»»ä½•çµæ§‹ï¼Œè«‹æª¢æŸ¥æ ¼å¼æ˜¯å¦æ­£ç¢ºã€‚");
        }
    }

    // 1. æ–°å¢å–®å…ƒ
    function populateAddUnitParentSelect() {
        const select = document.getElementById('add-unit-parent'); select.innerHTML = '';
        const createOpt = document.createElement('option'); createOpt.value = 'create_new_part'; createOpt.text = 'â• å»ºç«‹å…¨æ–°çš„éƒ¨ (æ ¹ç›®éŒ„)'; createOpt.style.fontWeight = 'bold'; createOpt.style.color = 'var(--primary)'; select.appendChild(createOpt);
        for (const key in quizDB) {
            const part = quizDB[key];
            const rootOpt = document.createElement('option'); rootOpt.value = `root|${key}`; rootOpt.text = `ğŸ“‚ ${part.title}`; select.appendChild(rootOpt);
            part.units.forEach(unit => {
                if (unit.subUnits) { const groupOpt = document.createElement('option'); groupOpt.value = `group|${key}|${unit.id}`; groupOpt.text = `ã€€â””â”€ ${unit.name}`; select.appendChild(groupOpt); }
            });
        } toggleFolderOption();
    }

    function toggleFolderOption() {
        const val = document.getElementById('add-unit-parent').value;
        document.getElementById('folder-option-container').style.display = (val === 'create_new_part' || val.startsWith('root')) ? 'block' : 'none';
    }

    function handleAddUnit() {
        const parentVal = document.getElementById('add-unit-parent').value;
        const name = document.getElementById('add-unit-name').value.trim();
        const isFolder = document.getElementById('is-folder-unit').checked;
        if (!name) { alert("è«‹è¼¸å…¥åç¨±ï¼"); return; }
        
        if (parentVal === 'create_new_part') {
            const newPartKey = `part_${new Date().getTime()}`; quizDB[newPartKey] = { title: name, units: [] };
        } else if (parentVal.startsWith('root')) {
            const partKey = parentVal.split('|')[1];
            const newUnit = { id: `u_${new Date().getTime()}`, name: name };
            if (isFolder) newUnit.subUnits = []; else newUnit.questions = [];
            quizDB[partKey].units.push(newUnit);
        } else if (parentVal.startsWith('group')) {
            const parts = parentVal.split('|');
            const unit = quizDB[parts[1]].units.find(u => u.id === parts[2]);
            if (unit) { if(!unit.subUnits) unit.subUnits=[]; unit.subUnits.push({ id: `u_${new Date().getTime()}`, name: name, questions: [] }); }
        }
        document.getElementById('add-unit-name').value = ''; initMenu(); refreshAllMenus(); alert("æ–°å¢æˆåŠŸï¼");
    }

    // 2. çµæ§‹ç®¡ç†
    function updateStructureScopeSelect() {
        const select = document.getElementById('structure-scope-select');
        select.innerHTML = '<option value="">-- è«‹é¸æ“‡ --</option><option value="ROOT">ã€æ ¹ç›®éŒ„ã€‘ç®¡ç†ã€Œéƒ¨ã€</option>';
        for (const key in quizDB) {
            const part = quizDB[key];
            const opt = document.createElement('option'); opt.value = `PART|${key}`; opt.text = `ç®¡ç†ã€Œ${part.title}ã€ä¸‹çš„å–®å…ƒ`; select.appendChild(opt);
            part.units.forEach(unit => {
                if (unit.subUnits) {
                    const subOpt = document.createElement('option'); subOpt.value = `UNIT|${key}|${unit.id}`; subOpt.text = `ç®¡ç†ã€Œ${unit.name}ã€ä¸‹çš„å­å–®å…ƒ`; select.appendChild(subOpt);
                }
            });
        }
    }

    function renderStructureEditor() {
        const val = document.getElementById('structure-scope-select').value;
        const container = document.getElementById('structure-editor-container');
        if (!val) { container.style.display = 'none'; return; }
        container.style.display = 'block';
        
        let items = []; let html = '';
        
        if (val === 'ROOT') {
            items = Object.keys(quizDB).map(k => ({ id: k, name: quizDB[k].title }));
            items.forEach((item, idx) => {
                html += createManageItemHTML(idx, items.length, item.name, 
                    `manageMoveRoot('${item.id}', -1)`, `manageMoveRoot('${item.id}', 1)`, `manageDeleteRoot('${item.id}')`, `manageRenameRoot('${item.id}')`);
            });
        } else if (val.startsWith('PART')) {
            const partKey = val.split('|')[1];
            items = quizDB[partKey].units;
            items.forEach((item, idx) => {
                html += createManageItemHTML(idx, items.length, item.name, 
                    `manageMoveUnit('${partKey}', ${idx}, -1)`, `manageMoveUnit('${partKey}', ${idx}, 1)`, `manageDeleteUnit('${partKey}', ${idx})`, `manageRenameUnit('${partKey}', ${idx})`);
            });
        } else if (val.startsWith('UNIT')) {
            const [_, partKey, unitId] = val.split('|');
            const unit = quizDB[partKey].units.find(u => u.id === unitId);
            items = unit.subUnits;
            items.forEach((item, idx) => {
                html += createManageItemHTML(idx, items.length, item.name, 
                    `manageMoveSubUnit('${partKey}', '${unitId}', ${idx}, -1)`, `manageMoveSubUnit('${partKey}', '${unitId}', ${idx}, 1)`, `manageDeleteSubUnit('${partKey}', '${unitId}', ${idx})`, `manageRenameSubUnit('${partKey}', '${unitId}', ${idx})`);
            });
        }
        container.innerHTML = html || '<div style="padding:10px;text-align:center;">ç„¡é …ç›®</div>';
    }

    function createManageItemHTML(idx, total, name, moveUpFn, moveDownFn, delFn, renameFn) {
        return `<div class="manage-item"><div class="manage-info">${idx+1}. ${name}</div><div class="manage-actions">
                <button class="sm-btn" onclick="${renameFn}">âœï¸</button>${idx > 0 ? `<button class="sm-btn" onclick="${moveUpFn}">â¬†ï¸</button>` : ''}${idx < total-1 ? `<button class="sm-btn" onclick="${moveDownFn}">â¬‡ï¸</button>` : ''}<button class="sm-btn del" onclick="${delFn}">ğŸ—‘ï¸</button></div></div>`;
    }

    // çµæ§‹ç®¡ç†å‹•ä½œ
    function manageRenameRoot(key) { const n = prompt("æ–°åç¨±ï¼š", quizDB[key].title); if(n&&n.trim()){ quizDB[key].title=n.trim(); initMenu(); refreshAllMenus(); renderStructureEditor(); } }
    function manageRenameUnit(pk, idx) { const u = quizDB[pk].units[idx]; const n = prompt("æ–°åç¨±ï¼š", u.name); if(n&&n.trim()){ u.name=n.trim(); initMenu(); refreshAllMenus(); renderStructureEditor(); } }
    function manageRenameSubUnit(pk, uid, idx) { const u = quizDB[pk].units.find(i=>i.id===uid); const s = u.subUnits[idx]; const n = prompt("æ–°åç¨±ï¼š", s.name); if(n&&n.trim()){ s.name=n.trim(); initMenu(); refreshAllMenus(); renderStructureEditor(); } }

    function manageMoveRoot(key, dir) { const keys = Object.keys(quizDB); const idx = keys.indexOf(key); if(idx<0)return; const temp=keys[idx]; keys[idx]=keys[idx+dir]; keys[idx+dir]=temp; const tDB={}; keys.forEach(k=>tDB[k]=quizDB[k]); keys.forEach(k=>delete quizDB[k]); keys.forEach(k=>quizDB[k]=tDB[k]); initMenu(); refreshAllMenus(); renderStructureEditor(); }
    function manageDeleteRoot(key) { if(confirm("åˆªé™¤æ­¤éƒ¨ï¼Ÿ")) { delete quizDB[key]; initMenu(); refreshAllMenus(); document.getElementById('structure-scope-select').value=""; renderStructureEditor(); } }
    function manageMoveUnit(pk, idx, dir) { const arr=quizDB[pk].units; [arr[idx],arr[idx+dir]]=[arr[idx+dir],arr[idx]]; initMenu(); refreshAllMenus(); renderStructureEditor(); }
    function manageDeleteUnit(pk, idx) { if(confirm("åˆªé™¤æ­¤å–®å…ƒï¼Ÿ")) { quizDB[pk].units.splice(idx,1); initMenu(); refreshAllMenus(); renderStructureEditor(); } }
    function manageMoveSubUnit(pk, uid, idx, dir) { const u=quizDB[pk].units.find(i=>i.id===uid); const arr=u.subUnits; [arr[idx],arr[idx+dir]]=[arr[idx+dir],arr[idx]]; initMenu(); refreshAllMenus(); renderStructureEditor(); }
    function manageDeleteSubUnit(pk, uid, idx) { if(confirm("åˆªé™¤æ­¤å­å–®å…ƒï¼Ÿ")) { const u=quizDB[pk].units.find(i=>i.id===uid); u.subUnits.splice(idx,1); initMenu(); refreshAllMenus(); renderStructureEditor(); } }

    // 3. åŒ¯å…¥
    function populateUnitSelect(select) {
        if(!select) return; select.innerHTML = '<option value="">-- è«‹é¸æ“‡å–®å…ƒ --</option>';
        for(const k in quizDB) {
            quizDB[k].units.forEach(u => {
                if(u.subUnits) {
                    let groupOpt = document.createElement('option'); groupOpt.value = u.id; groupOpt.text = `ğŸ“‚ ${u.name} (ç›®éŒ„)`; select.add(groupOpt);
                    u.subUnits.forEach(s => { let o = document.createElement('option'); o.value = s.id; o.text = `ã€€â””â”€ ${s.name}`; select.add(o); });
                } else { let o = document.createElement('option'); o.value = u.id; o.text = u.name; select.add(o); }
            });
        }
    }

    function parseAndImport() {
        const text = document.getElementById('input-questions').value;
        const targetId = document.getElementById('import-target-unit').value;
        const blocks = text.split(/\n\s*\n/);
        let addedCount = 0; let log = [];

        blocks.forEach(block => {
            const lines = block.split('\n').map(l => l.trim()).filter(l => l);
            if (lines.length < 5) return;
            let q = { q: "", options: [], ans: 0, exp: "" };
            let unitNameText = "";
            lines.forEach(line => {
                 if (line.startsWith("å–®å…ƒï¼š") || line.startsWith("å–®å…ƒ:")) unitNameText = line.split(/[:ï¼š]/)[1].trim();
                 else if (line.startsWith("å•é¡Œï¼š") || line.startsWith("å•é¡Œ:")) q.q = line.split(/[:ï¼š]/)[1].trim();
                 else if (line.match(/^[A-D][ï¼š:.]/)) { let parts = line.split(/[:ï¼š.]/); q.options.push(`${parts[0].trim()}. ${parts.slice(1).join(".").trim()}`); }
                 else if (line.startsWith("æ­£ç¢ºç­”æ¡ˆ")) { let s = line.split(/[:ï¼š]/)[1].trim().toUpperCase(); q.ans = {'A':1,'B':2,'C':3,'D':4}[s] || parseInt(s); }
                 else if (line.startsWith("è§£æ")) q.exp = line.split(/[:ï¼š]/)[1].trim();
            });
            let target = targetId ? findUnitById(targetId) : (unitNameText ? findUnitByName(unitNameText) : null);
            if (target && q.q && q.options.length === 4) {
                if (!target.questions) { log.push(`âš ï¸ è·³éï¼šå–®å…ƒã€Œ${target.name}ã€æ˜¯ç›®éŒ„ã€‚`); } else { target.questions.push(q); addedCount++; log.push(`âœ… ${target.name}`); }
            }
        });
        if(addedCount>0) { alert(`åŠ å…¥ ${addedCount} é¡Œï¼`); document.getElementById('input-questions').value=""; loadQuestionsForDeletion(); }
        else alert(`æœªåŠ å…¥ã€‚\n${log.join('\n')}`);
    }
    
    function findUnitByName(name) { for(const k in quizDB){ for(let u of quizDB[k].units){ if(u.name===name)return u; if(u.subUnits){let s=u.subUnits.find(i=>i.name===name);if(s)return s;} } } return null; }
    
    // --- åˆªé™¤èˆ‡ç·¨è¼¯ (Modified) ---
    function loadQuestionsForDeletion() {
        const uid = document.getElementById('delete-unit-select').value; const con = document.getElementById('delete-list-container');
        if(!uid){ con.style.display='none'; return; }
        const unit = findUnitById(uid);
        if(!unit || !unit.questions || !unit.questions.length) { con.style.display='block'; con.innerHTML='<div style="padding:10px;text-align:center;">æ­¤å–®å…ƒ(æˆ–ç›®éŒ„)ç„¡é¡Œç›®</div>'; return; }
        con.style.display='block'; let h=''; 
        unit.questions.forEach((q,i) => { 
            // [æ–°å¢] ç·¨è¼¯æŒ‰éˆ•
            h+=`<div class="delete-item">
                    <div style="flex:1;">${i+1}. ${q.q.substring(0,20)}...</div>
                    <button class="edit-btn" onclick="openEditQuestionModal('${uid}', ${i})">âœï¸</button>
                    <button class="delete-btn" onclick="deleteQuestion('${uid}',${i})">åˆªé™¤</button>
                </div>`; 
        });
        con.innerHTML = h;
    }
    
    function deleteQuestion(uid, idx) { if(confirm("åˆªé™¤æ­¤é¡Œï¼Ÿ")) { findUnitById(uid).questions.splice(idx,1); loadQuestionsForDeletion(); } }

    // --- ç·¨è¼¯é¡Œç›®åŠŸèƒ½ (New Functions) ---
    function openEditQuestionModal(unitId, index) {
        const unit = findUnitById(unitId);
        if (!unit || !unit.questions[index]) return;
        
        const q = unit.questions[index];
        currentEditUnitId = unitId;
        currentEditIndex = index;
        
        // è§£æé¸é … (ç§»é™¤å‰é¢çš„ "A. " ç­‰æ¨™ç±¤)
        const getOptText = (optStr) => {
            const parts = optStr.split('.');
            return parts.length > 1 ? parts.slice(1).join('.').trim() : optStr;
        };

        document.getElementById('edit-q-text').value = q.q;
        document.getElementById('edit-opt-1').value = getOptText(q.options[0]);
        document.getElementById('edit-opt-2').value = getOptText(q.options[1]);
        document.getElementById('edit-opt-3').value = getOptText(q.options[2]);
        document.getElementById('edit-opt-4').value = getOptText(q.options[3]);
        document.getElementById('edit-q-ans').value = q.ans;
        document.getElementById('edit-q-exp').value = q.exp || "";
        
        document.getElementById('edit-question-modal').style.display = 'flex';
        toggleSidebar(); // é—œé–‰å´é‚Šæ¬„ä»¥å…é®æ“‹
    }

    function saveEditedQuestion() {
        const unit = findUnitById(currentEditUnitId);
        if (!unit) return;
        
        const qText = document.getElementById('edit-q-text').value;
        const opt1 = document.getElementById('edit-opt-1').value;
        const opt2 = document.getElementById('edit-opt-2').value;
        const opt3 = document.getElementById('edit-opt-3').value;
        const opt4 = document.getElementById('edit-opt-4').value;
        const ans = parseInt(document.getElementById('edit-q-ans').value);
        const exp = document.getElementById('edit-q-exp').value;

        if (!qText || !opt1 || !opt2 || !opt3 || !opt4) {
            alert("è«‹å¡«å¯«å®Œæ•´é¡Œç›®èˆ‡é¸é …ï¼");
            return;
        }

        // æ›´æ–°è³‡æ–™
        unit.questions[currentEditIndex] = {
            q: qText,
            options: [`A. ${opt1}`, `B. ${opt2}`, `C. ${opt3}`, `D. ${opt4}`],
            ans: ans,
            exp: exp
        };

        closeModal('edit-question-modal');
        loadQuestionsForDeletion(); // åˆ·æ–°åˆ—è¡¨
        alert("ä¿®æ”¹å·²ä¿å­˜ï¼\nè«‹è¨˜å¾—æŒ‰ã€Œä¸‹è¼‰æ›´æ–°æª”ã€ä»¥æ°¸ä¹…ç”Ÿæ•ˆã€‚");
    }

    function downloadUpdatedFile() {
        let html = "<!DOCTYPE html>\n" + document.documentElement.outerHTML;
        let start = html.indexOf("// --- QUIZDB START ---");
        let end = html.indexOf("// --- QUIZDB END ---");
        let newDB = "const quizDB = " + JSON.stringify(quizDB, null, 4) + ";";
        let final = html.substring(0, start + 23) + "\n    " + newDB + "\n    " + html.substring(end);
        let a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([final], {type:'text/html'}));
        let d = new Date(); a.download = `æ­·å²éš¨èº«æ¸¬_v${d.getMonth()+1}${d.getDate()}_${d.getHours()}${d.getMinutes()}.html`;
        a.click();
    }
// --- æ–°å¢åŠŸèƒ½ï¼šé¡Œç›®æ‰¹é‡ç®¡ç†ç³»çµ± (é€²éšç‰ˆ) ---

    function openBatchQManager() {
        const select = document.getElementById('batch-unit-select');
        select.innerHTML = '<option value="">-- è«‹é¸æ“‡ç®¡ç†ç¯„åœ --</option>';
        
        // è¼‰å…¥ä¸‹æ‹‰é¸å–® (åŒ…å«ã€Œæ•´å†Šã€é¸é …)
        for (const key in quizDB) {
            const part = quizDB[key];
            
            // 1. åŠ å…¥ã€Œæ•´å†Šã€é¸é … (è·¨å–®å…ƒé¡¯ç¤º)
            const partOpt = document.createElement('option');
            partOpt.value = `PART_${key}`;
            partOpt.innerText = `ğŸ“‚ [æ•´å†Š] ${part.title} (é¡¯ç¤ºå…¨éƒ¨)`;
            partOpt.style.fontWeight = 'bold';
            partOpt.style.color = '#1a237e';
            select.appendChild(partOpt);

            // 2. åŠ å…¥ã€Œå€‹åˆ¥å–®å…ƒã€é¸é …
            part.units.forEach(unit => {
                if (unit.subUnits) {
                    unit.subUnits.forEach(sub => {
                        const opt = document.createElement('option');
                        opt.value = `${sub.id}`; // è¨˜éŒ„å–®ä¸€ ID
                        opt.innerText = `ã€€â”” ${unit.name} - ${sub.name}`;
                        select.appendChild(opt);
                    });
                } else {
                    const opt = document.createElement('option');
                    opt.value = `${unit.id}`;
                    opt.innerText = `ã€€â”” ${unit.name}`;
                    select.appendChild(opt);
                }
            });
        }
        
        document.getElementById('batch-q-list').innerHTML = '<div style="text-align:center; color:#999; margin-top:20px;">è«‹å…ˆé¸æ“‡ç¯„åœ</div>';
        document.getElementById('batch-select-all-check').checked = false;
        document.getElementById('batch-manage-modal').style.display = 'flex';
    }

    function renderBatchQList() {
        const selectVal = document.getElementById('batch-unit-select').value;
        const list = document.getElementById('batch-q-list');
        const statusText = document.getElementById('batch-status-text');
        
        // é‡ç½®å…¨é¸æŒ‰éˆ•
        document.getElementById('batch-select-all-check').checked = false;

        if (!selectVal) {
            list.innerHTML = '<div style="text-align:center; color:#999; margin-top:20px;">è«‹å…ˆé¸æ“‡ç¯„åœ</div>';
            statusText.innerText = '';
            return;
        }

        let questionsToShow = [];
        let isMultiUnit = false;

        // åˆ¤æ–·æ˜¯é¸æ“‡ã€Œæ•´å†Šã€é‚„æ˜¯ã€Œå–®ä¸€å–®å…ƒã€
        if (selectVal.startsWith('PART_')) {
            // é¸æ“‡äº†æ•´å†Šï¼Œæ”¶é›†è©²å†Šæ‰€æœ‰å–®å…ƒçš„é¡Œç›®
            const partKey = selectVal.replace('PART_', '');
            const part = quizDB[partKey];
            isMultiUnit = true; // æ¨™è¨˜ç‚ºå¤šå–®å…ƒæ¨¡å¼ (éš±è—æ’åºæŒ‰éˆ•)

            part.units.forEach(unit => {
                if (unit.subUnits) {
                    unit.subUnits.forEach(sub => {
                        sub.questions.forEach((q, idx) => {
                            questionsToShow.push({ q: q, unitId: sub.id, index: idx, unitName: sub.name });
                        });
                    });
                } else {
                    unit.questions.forEach((q, idx) => {
                        questionsToShow.push({ q: q, unitId: unit.id, index: idx, unitName: unit.name });
                    });
                }
            });
        } else {
            // å–®ä¸€å–®å…ƒ
            const unit = findUnitById(selectVal);
            if (unit && unit.questions) {
                unit.questions.forEach((q, idx) => {
                    questionsToShow.push({ q: q, unitId: selectVal, index: idx, unitName: unit.name });
                });
            }
        }

        if (questionsToShow.length === 0) {
            list.innerHTML = '<div style="text-align:center; color:#999; margin-top:20px;">æ­¤ç¯„åœæ²’æœ‰é¡Œç›®</div>';
            statusText.innerText = 'å…± 0 é¡Œ';
            return;
        }

        statusText.innerText = `å…± ${questionsToShow.length} é¡Œ`;

        let html = '';
        questionsToShow.forEach((item, displayIdx) => {
            // çµ„åˆå”¯ä¸€è­˜åˆ¥ç¢¼ï¼šå–®å…ƒID|é¡Œç›®ç´¢å¼•
            const uniqueVal = `${item.unitId}|${item.index}`;
            
            html += `
            <div style="background:white; padding:10px; margin-bottom:8px; border-radius:6px; border:1px solid #ddd; display:flex; align-items:center; gap:10px;">
                <input type="checkbox" class="batch-del-check" value="${uniqueVal}" style="transform:scale(1.3);">
                
                <div style="flex:1; overflow:hidden;">
                    ${isMultiUnit ? `<div style="font-size:12px; color:#666; background:#eee; display:inline-block; padding:2px 6px; border-radius:4px; margin-bottom:4px;">${item.unitName}</div>` : ''}
                    <div style="font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
                        <span style="font-weight:bold; color:var(--primary);">#${item.index + 1}</span> ${item.q.q}
                    </div>
                </div>

                <div style="display:flex; gap:5px;">
                    ${!isMultiUnit ? `
                        ${item.index > 0 ? `<button onclick="moveQuestion('${item.unitId}', ${item.index}, -1)" style="cursor:pointer; padding:5px 8px; border:1px solid #ddd; background:#fff; border-radius:4px;">â¬†ï¸</button>` : '<span style="width:34px;"></span>'}
                        ${item.index < questionsToShow.length - 1 ? `<button onclick="moveQuestion('${item.unitId}', ${item.index}, 1)" style="cursor:pointer; padding:5px 8px; border:1px solid #ddd; background:#fff; border-radius:4px;">â¬‡ï¸</button>` : '<span style="width:34px;"></span>'}
                    ` : '<span style="font-size:12px; color:#999;">(æ’åºé™å–®å…ƒ)</span>'}
                </div>
            </div>`;
        });
        list.innerHTML = html;
    }

    function toggleBatchSelectAll() {
        const masterCheck = document.getElementById('batch-select-all-check');
        const checkboxes = document.querySelectorAll('.batch-del-check');
        checkboxes.forEach(cb => cb.checked = masterCheck.checked);
    }

    function moveQuestion(unitId, index, direction) {
        const unit = findUnitById(unitId);
        if (!unit) return;
        const targetIndex = index + direction;
        [unit.questions[index], unit.questions[targetIndex]] = [unit.questions[targetIndex], unit.questions[index]];
        renderBatchQList(); 
    }

    function deleteSelectedQuestions() {
        const checkboxes = document.querySelectorAll('.batch-del-check:checked');
        if (checkboxes.length === 0) {
            alert("è«‹å…ˆå‹¾é¸è¦åˆªé™¤çš„é¡Œç›®ï¼");
            return;
        }

        if (!confirm(`ç¢ºå®šè¦åˆªé™¤é€™ ${checkboxes.length} é¡Œå—ï¼Ÿ\n\næ³¨æ„ï¼šåˆªé™¤å¾Œé¡Œç›®é †åºæœƒæ”¹è®Šï¼Œ\næ­¤å‹•ä½œç„¡æ³•å¾©åŸï¼`)) return;

        // è§£æé¸å–çš„é …ç›® (æ ¼å¼ï¼šunitId|index)
        // æˆ‘å€‘éœ€è¦ä¾ç…§å–®å…ƒåˆ†çµ„ï¼Œä¸¦ä¸”æ¯å€‹å–®å…ƒå…§ã€Œå¾å¾Œå¾€å‰ã€åˆªé™¤ï¼Œæ‰ä¸æœƒå½±éŸ¿ç´¢å¼•
        const deletionMap = {};

        checkboxes.forEach(cb => {
            const [uId, idxStr] = cb.value.split('|');
            const idx = parseInt(idxStr);
            if (!deletionMap[uId]) deletionMap[uId] = [];
            deletionMap[uId].push(idx);
        });

        // åŸ·è¡Œåˆªé™¤
        for (const uId in deletionMap) {
            const unit = findUnitById(uId);
            if (!unit) continue;
            
            // å°‡ç´¢å¼•ç”±å¤§åˆ°å°æ’åº (é—œéµæ­¥é©Ÿ)
            deletionMap[uId].sort((a, b) => b - a);
            
            deletionMap[uId].forEach(delIdx => {
                unit.questions.splice(delIdx, 1);
            });
        }

        alert("åˆªé™¤æˆåŠŸï¼");
        renderBatchQList(); // é‡æ–°æ•´ç†ç•«é¢
    }
// ==========================================
// â˜…â˜…â˜… å½©è›‹åŠŸèƒ½å€ (è«‹è²¼åœ¨æ‰€æœ‰ç¨‹å¼ç¢¼çš„æœ€å¾Œé¢) â˜…â˜…â˜…
// ==========================================

function updateEasterEggs() {
    console.log("æª¢æŸ¥å½©è›‹çå‹µ...");

    // 1. å†æ¬¡æŠ“å–æ‰€æœ‰é¡Œç›® (è¨ˆç®—åˆ†æ¯)
    let allQuestions = [];
    if (typeof quizDB !== 'undefined') {
        Object.values(quizDB).forEach(part => {
            if (part.units) part.units.forEach(u => {
                if (u.subUnits) u.subUnits.forEach(s => { if(s.questions) allQuestions = allQuestions.concat(s.questions); });
                if (u.questions) allQuestions = allQuestions.concat(u.questions);
            });
        });
    }
    // è£œå¼·ï¼šæŠ“å–å…¨åŸŸè®Šæ•¸
    if (typeof questions !== 'undefined' && Array.isArray(questions)) {
        allQuestions = allQuestions.concat(questions);
    }

    // 2. è¨ˆç®—å·²å®Œæˆé¡Œæ•¸ (è¨ˆç®—åˆ†å­)
    const history = JSON.parse(localStorage.getItem('quizHistory') || '[]');
    const doneSet = new Set();
    history.forEach(rec => {
        if (rec.questionIds) rec.questionIds.forEach(id => { if(id) doneSet.add(id); });
    });

    // 3. ç®—å‡ºç™¾åˆ†æ¯”
    let doneCount = doneSet.size;
    let totalCount = allQuestions.length;
    if (doneCount > totalCount) totalCount = doneCount; 
    const displayTotal = totalCount > 0 ? totalCount : 1;
    const percent = Math.round((doneCount / displayTotal) * 100);
    
    // 4. æ±ºå®šç­‰ç´š (æ¯10%ä¸€ç´š)
    const level = Math.floor(percent / 10); 

    // 5. è¨­å®šçå‹µåœ–ç‰‡ (å¯è‡ªè¡Œæ›´æ›åœ–ç‰‡ç¶²å€)
    const rewards = [
        { img: "images/lv1.jpg", text: "åˆå‡ºèŒ…å»¬" },  // å°æ‡‰ 10%
        { img: "images/lv2.jpg", text: "æ¼¸å…¥ä½³å¢ƒ" },  // å°æ‡‰ 20%
        { img: "images/lv3.jpg", text: "å­¸å¯Œäº”è»Š" },  // å°æ‡‰ 30%
        { img: "images/lv4.jpg", text: "èæœƒè²«é€š" },  
        { img: "images/lv5.jpg", text: "åšå¤é€šä»Š" },
        { img: "images/lv6.jpg", text: "æ­·å²é”äºº" },
        { img: "images/lv7.jpg", text: "ä¸€ä»£å®—å¸«" },
        { img: "images/lv8.jpg", text: "ç™»å³°é€ æ¥µ" },
        { img: "images/lv9.jpg", text: "ç¨å­¤æ±‚æ•—" },
        { img: "images/lv10.jpg", text: "æ­·å²ä¹‹ç¥" } // å°æ‡‰ 100%
    ];

    // 6. é¡¯ç¤ºåˆ°ç•«é¢ä¸Š
    const gallery = document.getElementById('egg-gallery');
    if (!gallery) return;

    if (level === 0) {
        // ... (é€™è¡Œä¸ç”¨å‹•) ...
    } else {
        let html = '';
        // è¿´åœˆï¼šé¡¯ç¤ºæ‰€æœ‰å·²è§£é–çš„åœ–ç‰‡
        for (let i = 0; i < level && i < 10; i++) {
            html += `
                <div style="text-align:center; margin:15px; animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);">
                    <img src="${rewards[i].img}" style="width:150px; height:150px; border-radius:50%; box-shadow:0 4px 8px rgba(0,0,0,0.3); border:3px solid white; object-fit: cover;">
                    
                    <div style="font-size:0.9em; color:#555; margin-top:8px; font-weight:bold;">${rewards[i].text}</div>
                </div>
            `;
        }
        gallery.innerHTML = html;
    }
}

// â˜…â˜…â˜… è‡ªå‹•å•Ÿå‹•ï¼šç•¶ç¶²é è¼‰å…¥å®Œæˆå¾Œï¼ŒåŸ·è¡Œé€™äº›å‹•ä½œ â˜…â˜…â˜…
window.onload = function() {
    // 1. å˜—è©¦è¼‰å…¥èˆŠè³‡æ–™ (å¦‚æœæœ‰é€™äº›åŠŸèƒ½çš„è©±)
    if(typeof loadData === 'function') try { loadData(); } catch(e){}
    if(typeof initMenu === 'function') try { initMenu(); } catch(e){}
    
    // 2. é¡¯ç¤ºé¦–é  (è«‹ç¢ºä¿æ‚¨çš„é¦–é  ID æ­£ç¢ºï¼Œä¾‹å¦‚ view-welcome)
    if(typeof showView === 'function') showView('view-welcome'); 

    // 3. åŸ·è¡Œå‰›å‰›å¯«å¥½çš„å½©è›‹æª¢æŸ¥
    updateEasterEggs();
};
// â˜…â˜…â˜… å•Ÿå‹•å°èˆªåˆ—æ™‚é˜ â˜…â˜…â˜…
function startNavClock() {
    const clockEl = document.getElementById('nav-clock');
    if (!clockEl) return;

    function update() {
        const now = new Date();
        
        // å–å¾— å¹´/æœˆ/æ—¥
        const dateStr = now.getFullYear() + '/' + 
                        String(now.getMonth() + 1).padStart(2, '0') + '/' + 
                        String(now.getDate()).padStart(2, '0');
        
        // å–å¾— æ™‚:åˆ†:ç§’
        const timeStr = String(now.getHours()).padStart(2, '0') + ':' + 
                        String(now.getMinutes()).padStart(2, '0') + ':' + 
                        String(now.getSeconds()).padStart(2, '0');

        // çµ„åˆé¡¯ç¤º (æ‰‹æ©Ÿç‰ˆå¦‚æœå¤ªæ“ ï¼Œå¯ä»¥åªé¡¯ç¤ºæ™‚é–“ï¼Œé€™è£¡é è¨­å…¨é¡¯ç¤º)
        // ç‚ºäº†ç¾è§€ï¼Œæˆ‘å€‘ç”¨ <small> æ¨™ç±¤è®“æ—¥æœŸç¨å¾®å°ä¸€é»é»
        clockEl.innerHTML = `<span style="opacity:0.8; font-size:0.9em;">${dateStr}</span> ${timeStr}`;
    }

    // ç«‹å³åŸ·è¡Œä¸€æ¬¡ï¼Œé¿å…å‰›è¼‰å…¥æ™‚æœ‰ç©ºçª—æœŸ
    update();
    // è¨­å®šæ¯ç§’ (1000æ¯«ç§’) æ›´æ–°ä¸€æ¬¡
    setInterval(update, 1000);
}

// ç¢ºä¿ç¶²é è¼‰å…¥å¾Œç«‹å³å•Ÿå‹•æ™‚é˜
// å¦‚æœæ‚¨åŸæœ¬å·²æœ‰ window.onloadï¼Œè«‹æŠŠ startNavClock() åŠ é€²å»
// æˆ–è€…ç›´æ¥åœ¨ script æœ€å¾Œé¢å‘¼å«å®ƒï¼š
document.addEventListener('DOMContentLoaded', startNavClock);

</script>
<div id="batch-manage-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 700px; height: 85vh; display:flex; flex-direction:column;">
        <h3>ğŸ“Š é¡Œç›®æ‰¹é‡ç®¡ç†ç³»çµ±</h3>
        
        <div style="margin-bottom: 10px; text-align: left;">
            <label style="font-weight:bold;">é¡¯ç¤ºç¯„åœï¼š</label>
            <select id="batch-unit-select" onchange="renderBatchQList()" style="width:100%; padding:10px; margin-top:5px; border:1px solid #ccc; border-radius:8px;"><option value="">-- è«‹é¸æ“‡ç®¡ç†ç¯„åœ --</option><option value="PART_part_1768479449174_j0foo" style="font-weight: bold; color: rgb(26, 35, 126);">ğŸ“‚ [æ•´å†Š] ç”²éƒ¨ (é¡¯ç¤ºå…¨éƒ¨)</option><option value="u_1768479449174_lx1pi">ã€€â”” å¤å•†å‘¨ - å…©æ¬¡åˆ†å°</option><option value="u_1768479449174_q64k1">ã€€â”” å¤å•†å‘¨ - å°å»ºã€ç¦®æ¨‚ã€å®—æ³•åˆ¶åº¦</option><option value="u_1768479449174_riz5p">ã€€â”” å¤å•†å‘¨ - æ˜¥ç§‹æˆ°åœ‹çš„æ”¿æ²»è®Šå‹•</option><option value="u_1768479449174_ght5l">ã€€â”” å¤å•†å‘¨ - æ˜¥ç§‹æˆ°åœ‹çš„ç¤¾æœƒè®Šå‹•</option><option value="u_1768479449174_mdm59">ã€€â”” ç§¦æ¼¢ - ç§¦å§‹çš‡çš„çµ±æ²»æ€æƒ³</option><option value="u_1768479449174_mvexj">ã€€â”” ç§¦æ¼¢ - ç§¦å§‹çš‡çš„çµ±æ²»æ”¿ç­–</option><option value="u_1768479449174_mzdgb">ã€€â”” ç§¦æ¼¢ - æ¼¢æ­¦å¸çš„çµ±æ²»æ€æƒ³</option><option value="u_1768479449174_v115d">ã€€â”” ç§¦æ¼¢ - æ¼¢æ­¦å¸çš„çµ±æ²»æ”¿ç­–</option><option value="u_1768479449174_r9vo5">ã€€â”” éš‹å” - é–‹çš‡ä¹‹æ²»</option><option value="u_1768479449174_pd40w">ã€€â”” éš‹å” - è²è§€ä¹‹æ²»</option><option value="u_1768479449174_3f9yh">ã€€â”” éš‹å” - é–‹å…ƒä¹‹æ²»</option><option value="u_1768479449174_hujez">ã€€â”” éš‹å” - å®‰å²ä¹‹äº‚</option><option value="u_1768479449174_prib8">ã€€â”” å®‹å…ƒæ˜æ¸… - æ˜å¤ªç¥–çš„å›ä¸»é›†æ¬Š</option><option value="u_1768479449174_zgj24">ã€€â”” å®‹å…ƒæ˜æ¸… - æ˜æˆç¥–çš„å›ä¸»é›†æ¬Š</option><option value="u_1768479449174_p5r8r">ã€€â”” å®‹å…ƒæ˜æ¸… - æ˜ä»£å›ä¸»é›†æ¬Šçš„æˆæ•ˆèˆ‡æµå¼Š</option><option value="PART_part_1768480267921_9igzt" style="font-weight: bold; color: rgb(26, 35, 126);">ğŸ“‚ [æ•´å†Š] ä¹™éƒ¨ (é¡¯ç¤ºå…¨éƒ¨)</option><option value="u_1768480267921_ljl5n">ã€€â”” ä¸­è¯äººæ°‘å…±å’Œåœ‹ - å»ºåœ‹åˆå¹´(1949-1952)</option><option value="u_1768480267921_4wm4b">ã€€â”” ä¸­è¯äººæ°‘å…±å’Œåœ‹ - ç¤¾æœƒä¸»ç¾©æ”¹é€ èˆ‡ä¸€äº”è¨ˆåŠƒ(1953-1957)</option><option value="u_1768480267921_8x6fs">ã€€â”” ä¸­è¯äººæ°‘å…±å’Œåœ‹ - å…¨é¢å»ºè¨­ç¤¾æœƒä¸»ç¾©èˆ‡ä¸‰é¢ç´…æ——(1958-1960)</option><option value="u_1768480267921_wt3ju">ã€€â”” ä¸­è¯äººæ°‘å…±å’Œåœ‹ - èª¿æ•´æ”¿ç­–(1961-1964)</option><option value="u_1768483861832">ã€€â”” ä¸­è¯äººæ°‘å…±å’Œåœ‹ - æ–‡åŒ–å¤§é©å‘½(1966-1976)</option><option value="u_1768483418939">ã€€â”” ä¸­è¯äººæ°‘å…±å’Œåœ‹ - æ”¹é©é–‹æ”¾(1978-)</option></select>
        </div>

        <div style="padding: 10px; background: #e3f2fd; border-radius: 8px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between;">
            <label style="display:flex; align-items:center; cursor:pointer; font-weight:bold; color:var(--primary);">
                <input type="checkbox" id="batch-select-all-check" onchange="toggleBatchSelectAll()" style="transform:scale(1.3); margin-right: 10px;">
                å…¨é¸ç›®å‰é¡¯ç¤ºçš„é¡Œç›®
            </label>
            <span id="batch-status-text" style="font-size: 0.9em; color: #666;">å…± 0 é¡Œ</span>
        </div>

        <div style="flex:1; overflow-y:auto; border:1px solid #eee; border-radius:8px; padding:10px; margin-bottom:15px; background:#f9f9f9;" id="batch-q-list"><div style="text-align:center; color:#999; margin-top:20px;">æ­¤ç¯„åœæ²’æœ‰é¡Œç›®</div></div>

        <div style="display:flex; gap:10px; justify-content:space-between; border-top:1px solid #eee; padding-top:15px;">
            <button onclick="deleteSelectedQuestions()" style="background:#ffebee; color:var(--error); border:1px solid var(--error); padding:10px 20px; border-radius:6px; cursor:pointer; font-weight:bold;">ğŸ—‘ï¸ åˆªé™¤é¸å–é …ç›®</button>
            <button onclick="closeModal('batch-manage-modal')" style="background:var(--gray); color:white; border:none; padding:10px 20px; border-radius:6px; cursor:pointer;">é—œé–‰</button>
        </div>
    </div>
</div>
</body></html>